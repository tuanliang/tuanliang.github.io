<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>docker_3 | 十一的博客</title><meta name="author" content="十一"><meta name="copyright" content="十一"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="这是显示在首页的概述，正文内容均会被隐藏。">
<meta property="og:type" content="article">
<meta property="og:title" content="docker_3">
<meta property="og:url" content="https://tuanliang.github.io/2024/04/28/docker-3/index.html">
<meta property="og:site_name" content="十一的博客">
<meta property="og:description" content="这是显示在首页的概述，正文内容均会被隐藏。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tuanliang.github.io/image/spring.png">
<meta property="article:published_time" content="2024-04-28T05:42:35.000Z">
<meta property="article:modified_time" content="2024-04-28T05:48:30.551Z">
<meta property="article:author" content="十一">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tuanliang.github.io/image/spring.png"><link rel="shortcut icon" href="/image/sharpicons_Cheetah.png"><link rel="canonical" href="https://tuanliang.github.io/2024/04/28/docker-3/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'docker_3',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-28 13:48:30'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/style/css/custom.css"><link rel="stylesheet" href="/style/css/iconfont.css"><link rel="stylesheet" type="text/css" href="/style/css/heoMainColor.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/image/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">47</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><meta name="referrer" content="no-referrer"><header class="post-bg" id="page-header" style="background-image: url('/image/spring.png')"><nav id="nav"><div id="nav-group"><span id="blog-info"><a href="/" title="十一的博客"><img class="site-icon" src="/image/sharpicons_Cheetah.png"/><span class="site-name">十一的博客</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div><div id="nav-right"><div id="search-button"><a class="site-page social-icon search"><i class="iconfont icat-search"></i></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="搜索本站文章"><i class="iconfont icat-bars"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">docker_3</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-04-28T05:42:35.000Z" title="发表于 2024-04-28 13:42:35">2024-04-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-28T05:48:30.551Z" title="更新于 2024-04-28 13:48:30">2024-04-28</time></span></div><div class="meta-secondline"><span class="post-meta-categories"><i class="iconfont icat-categories fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Docker/">Docker</a></span><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>25分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="docker_3"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:<section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-Docker复杂安装详说"><a href="#1-Docker复杂安装详说" class="headerlink" title="1 Docker复杂安装详说"></a>1 Docker复杂安装详说</h1><h2 id="1-1-安装MySQL主从复制"><a href="#1-1-安装MySQL主从复制" class="headerlink" title="1.1 安装MySQL主从复制"></a>1.1 安装MySQL主从复制</h2><h3 id="1-1-1-主从复制原理"><a href="#1-1-1-主从复制原理" class="headerlink" title="1.1.1 主从复制原理"></a>1.1.1 主从复制原理</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Guzarish/article/details/123244487">MySQL主从复制原理_牛奔的博客-CSDN博客</a></p>
<h3 id="1-1-2-主从搭建步骤"><a href="#1-1-2-主从搭建步骤" class="headerlink" title="1.1.2 主从搭建步骤"></a>1.1.2 主从搭建步骤</h3><ol>
<li>新建主服务器容器实例3307</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3307:3306 --name mysql-master \</span><br><span class="line">-v /mydata/mysql-master/log:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql-master/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql-master/conf:/etc/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root  \</span><br><span class="line">-d mysql:5.7</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>进入&#x2F;mydata&#x2F;mysql-master&#x2F;conf目录下新建my.cnf</li>
</ol>
<p><code>vim my.cnf</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 设置server_id，同一局域网中需要唯一</span></span></span><br><span class="line">server_id=101 </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 指定不需要同步的数据库名称</span></span></span><br><span class="line">binlog-ignore-db=mysql  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 开启二进制日志功能</span></span></span><br><span class="line">log-bin=mall-mysql-bin  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 设置二进制日志使用内存大小（事务）</span></span></span><br><span class="line">binlog_cache_size=1M  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 设置使用的二进制日志格式（mixed,statement,row）</span></span></span><br><span class="line">binlog_format=mixed  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 二进制日志过期清理时间。默认值为0，表示不自动清理。</span></span></span><br><span class="line">expire_logs_days=7  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span></span><br><span class="line">slave_skip_errors=1062</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改完配置后重启master实例</li>
</ol>
<p><code>docker restart mysql-master</code></p>
<ol start="4">
<li>进入mysql-master容器</li>
</ol>
<p><code>docker exec -it mysql-master /bin/bash</code><br><code>mysql -uroot -proot</code></p>
<ol start="5">
<li>master容器实例内创建数据同步用户</li>
</ol>
<p><code>CREATE USER &#39;slave&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;</code><br><code>GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &#39;slave&#39;@&#39;%&#39;;</code></p>
<ol start="6">
<li>新建从服务器容器实例3308</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3308:3306 --name mysql-slave \</span><br><span class="line">-v /mydata/mysql-slave/log:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql-slave/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql-slave/conf:/etc/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root  \</span><br><span class="line">-d mysql:5.7</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>进入&#x2F;mydata&#x2F;mysql-slave&#x2F;conf目录下新建my.cnf</li>
</ol>
<p><code>vim my.cnf</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 设置server_id，同一局域网中需要唯一</span></span></span><br><span class="line">server_id=102</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 指定不需要同步的数据库名称</span></span></span><br><span class="line">binlog-ignore-db=mysql  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 开启二进制日志功能，以备Slave作为其它数据库实例的Master时使用</span></span></span><br><span class="line">log-bin=mall-mysql-slave1-bin  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 设置二进制日志使用内存大小（事务）</span></span></span><br><span class="line">binlog_cache_size=1M  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 设置使用的二进制日志格式（mixed,statement,row）</span></span></span><br><span class="line">binlog_format=mixed  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 二进制日志过期清理时间。默认值为0，表示不自动清理。</span></span></span><br><span class="line">expire_logs_days=7  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span></span><br><span class="line">slave_skip_errors=1062  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># relay_log配置中继日志</span></span></span><br><span class="line">relay_log=mall-mysql-relay-bin  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># log_slave_updates表示slave将复制事件写进自己的二进制日志</span></span></span><br><span class="line">log_slave_updates=1  </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># slave设置为只读（具有super权限的用户除外）</span></span></span><br><span class="line">read_only=1</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>修改完配置后重启slave实例</li>
</ol>
<p><code>docker restart mysql-slave</code></p>
<ol start="9">
<li>在主数据库中查看主从同步状态</li>
</ol>
<p><code>show master status;</code></p>
<ol start="10">
<li>进入mysql-slave容器</li>
</ol>
<p><code>docker exec -it mysql-slave /bin/bash</code><br><code>mysql -uroot -proot</code></p>
<ol start="11">
<li>在从数据库中配置主从复制</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">change master to master_host=<span class="string">&#x27;宿主机ip&#x27;</span>, master_user=<span class="string">&#x27;slave&#x27;</span>, master_password=<span class="string">&#x27;123456&#x27;</span>, </span><br><span class="line">master_port=3307, master_log_file=<span class="string">&#x27;mall-mysql-bin.000001&#x27;</span>, master_log_pos=617, master_connect_retry=30;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658995661799-39e995e2-73e0-4e7d-bc9d-59c1fa0b8e3c.png#averageHue=%23fef9f9&clientId=u7522598d-4755-4&from=paste&height=384&id=u1b666ed1&originHeight=384&originWidth=1348&originalType=binary&ratio=1&rotation=0&showTitle=false&size=74465&status=done&style=none&taskId=u90f3664d-86e3-48f6-9a21-d7ee6222409&title=&width=1348" alt="image.png"><br>主从复制命令参数说明<br>:::info<br>master_host：主数据库的IP地址；<br>master_port：主数据库的运行端口；<br>master_user：在主数据库创建的用于同步数据的用户账号；<br>master_password：在主数据库创建的用于同步数据的用户密码；<br>master_log_file：指定从数据库要复制数据的日志文件，通过查看主数据的状态，获取File参数；<br>master_log_pos：指定从数据库从哪个位置开始复制数据，通过查看主数据的状态，获取Position参数；<br>master_connect_retry：连接失败重试的时间间隔，单位为秒。<br>:::</p>
<ol start="12">
<li>在从数据库中查看主从同步状态</li>
</ol>
<p><code>show slave status \G;</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658995728716-90fc0143-7a4d-465e-83c1-a17bad83823e.png#averageHue=%23fefdfd&clientId=u7522598d-4755-4&from=paste&height=333&id=Jj7wg&originHeight=333&originWidth=1084&originalType=binary&ratio=1&rotation=0&showTitle=false&size=144319&status=done&style=none&taskId=uebb0a947-b1af-4dcd-92d4-141799dd800&title=&width=1084" alt="image.png"></p>
<ol start="13">
<li>在从数据库中开启主从同步</li>
</ol>
<p><code>start slave;</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658995798230-fbe9f08c-af5d-4e83-915d-62302a5ad1a1.png#averageHue=%23fef4f4&clientId=u7522598d-4755-4&from=paste&height=100&id=u605c7e49&originHeight=100&originWidth=502&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22248&status=done&style=none&taskId=u9c9266b6-dd25-4d70-8183-62cd8906e9d&title=&width=502" alt="image.png"></p>
<ol start="14">
<li>查看从数据库状态发现已经同步</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658995805394-60a39a9a-8be4-43b7-9489-84afd4ef0310.png#averageHue=%23fefcfc&clientId=u7522598d-4755-4&from=paste&height=472&id=u514b0ec6&originHeight=472&originWidth=679&originalType=binary&ratio=1&rotation=0&showTitle=false&size=74820&status=done&style=none&taskId=u57401596-8685-4acd-ad19-68718c30921&title=&width=679" alt="image.png"></p>
<ol start="15">
<li>主从复制测试</li>
<li>主机新建库-使用库-新建表-插入数据，ok</li>
<li>从机使用库-查看记录，ok</li>
</ol>
<h2 id="1-2-安装redis集群-大厂面试题第4季-分布式存储案例真题"><a href="#1-2-安装redis集群-大厂面试题第4季-分布式存储案例真题" class="headerlink" title="1.2 安装redis集群(大厂面试题第4季-分布式存储案例真题)"></a>1.2 安装redis集群(大厂面试题第4季-分布式存储案例真题)</h2><p>cluster(集群)模式-docker版<br>哈希槽分区进行亿级数据存储</p>
<h3 id="1-2-1-面试题"><a href="#1-2-1-面试题" class="headerlink" title="1.2.1 面试题"></a>1.2.1 面试题</h3><p>1<del>2亿条数据需要缓存，请问如何设计这个存储案例？<br>回答：单机单台100%不可能，肯定是分布式存储，用redis如何落地？<br>上述问题阿里P6</del>P7工程案例和场景设计类必考题目， 一般业界有3种解决方案</p>
<ol>
<li>哈希取余分区</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658996785793-2ca8867b-2254-45ee-8bc7-8f566d737db2.png#averageHue=%23f6f0f0&clientId=u7522598d-4755-4&from=paste&height=323&id=u0b0a85cc&originHeight=323&originWidth=406&originalType=binary&ratio=1&rotation=0&showTitle=false&size=37813&status=done&style=none&taskId=u883d413c-599c-41ab-a09e-54ec1fae540&title=&width=406" alt="image.png"><br>:::info<br>2亿条记录就是2亿个k,v，我们单机不行必须要分布式多机，假设有3台机器构成一个集群，用户每次读写操作都是根据公式：<br>hash(key) % N个机器台数，计算出哈希值，用来决定数据映射到哪一个节点上。<br>优点：<br>简单粗暴，直接有效，只需要预估好数据规划好节点，例如3台、8台、10台，就能保证一段时间的数据支撑。使用Hash算法让固定的一部分请求落到同一台服务器上，这样每台服务器固定处理一部分请求（并维护这些请求的信息），起到负载均衡+分而治之的作用。<br>缺点：<br>原来规划好的节点，进行扩容或者缩容就比较麻烦了额，不管扩缩，每次数据变动导致节点有变动，映射关系需要重新进行计算，在服务器个数固定不变时没有问题，如果需要弹性扩容或故障停机的情况下，原来的取模公式就会发生变化：Hash(key)&#x2F;3会变成Hash(key) &#x2F;?。此时地址经过取余运算的结果将发生很大变化，根据公式获取的服务器也会变得不可控。<br>某个redis机器宕机了，由于台数数量变化，会导致hash取余全部数据重新洗牌。<br>:::</p>
<ol start="2">
<li>一致性哈希算法分区<ol>
<li><p>是什么<br>:::info<br>一致性Hash算法背景<br>一致性哈希算法在1997年由麻省理工学院中提出的，设计目标是为了解决分布式缓存数据变动和映射问题，某个机器宕机了，分母数量改变了，自然取余数不OK了。<br>:::</p>
</li>
<li><p>能干嘛</p>
</li>
</ol>
</li>
</ol>
<p>提出一致性Hash解决方案。 目的是当服务器个数发生变动时， 尽量减少影响客户端到服务器的映射关系</p>
<pre><code>  3. 3大步骤
     1. 算法构建一致性哈希环
        :::info
        一致性哈希环
          一致性哈希算法必然有个hash函数并按照算法产生hash值，这个算法的所有可能哈希值会构成一个全量集，这个集合可以成为一个hash空间[0,2^32-1]，这个是一个线性空间，但是在算法中，我们通过适当的逻辑控制将它首尾相连(0 = 2^32),这样让它逻辑上形成了一个环形空间。
          它也是按照使用取模的方法，前面笔记介绍的节点取模法是对节点（服务器）的数量进行取模。而一致性Hash算法是对2^32取模，简单来说，一致性Hash算法将整个哈希值空间组织成一个虚拟的圆环，如假设某哈希函数H的值空间为0-2^32-1（即哈希值是一个32位无符号整形），整个哈希环如下图：整个空间按顺时针方向组织，圆环的正上方的点代表0，0点右侧的第一个点代表1，以此类推，2、3、4、……直到2^32-1，也就是说0点左侧的第一个点代表2^32-1， 0和2^32-1在零点中方向重合，我们把这个由2^32个点组成的圆环称为Hash环。
        ![image.png](https://cdn.nlark.com/yuque/0/2022/png/27791237/1658999862145-25f18b54-2e15-47f3-a873-a5d44a16f866.png#averageHue=%23d0e5e4&amp;clientId=u7522598d-4755-4&amp;from=paste&amp;height=467&amp;id=u33594d6f&amp;originHeight=467&amp;originWidth=447&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=50985&amp;status=done&amp;style=none&amp;taskId=u56d8b604-908e-433d-96b0-32c3fe0d48a&amp;title=&amp;width=447)
        :::

     2. 服务器IP节点映射
        :::info
        节点映射
        将集群中各个IP节点映射到环上的某一个位置。
        将各个服务器使用Hash进行一个哈希，具体可以选择服务器的IP或主机名作为关键字进行哈希，这样每台机器就能确定其在哈希环上的位置。假如4个节点NodeA、B、C、D，经过IP地址的哈希函数计算(hash(ip))，使用IP地址哈希后在环空间的位置如下：  
        ![image.png](https://cdn.nlark.com/yuque/0/2022/png/27791237/1658999891472-39767eb6-5396-4b43-9cfb-71103e0758ec.png#averageHue=%23f1f2eb&amp;clientId=u7522598d-4755-4&amp;from=paste&amp;height=578&amp;id=u3d0840bc&amp;originHeight=578&amp;originWidth=565&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=106203&amp;status=done&amp;style=none&amp;taskId=u7aeacdc7-5e79-42ec-9faf-a8f11197140&amp;title=&amp;width=565)
        :::

     3. key落到服务器的落键规则
        :::info
        当我们需要存储一个kv键值对时，首先计算key的hash值，hash(key)，将这个key使用相同的函数Hash计算出哈希值并确定此数据在环上的位置，从此位置沿环顺时针“行走”，第一台遇到的服务器就是其应该定位到的服务器，并将该键值对存储在该节点上。
        如我们有Object A、Object B、Object C、Object D四个数据对象，经过哈希计算后，在环空间上的位置如下：根据一致性Hash算法，数据A会被定为到Node A上，B被定为到Node B上，C被定为到Node C上，D被定为到Node D上。
        ![image.png](https://cdn.nlark.com/yuque/0/2022/png/27791237/1658999908647-d6826cc9-9435-4701-8e42-9aaf09cee0be.png#averageHue=%23ecf0e8&amp;clientId=u7522598d-4755-4&amp;from=paste&amp;height=573&amp;id=u826399e8&amp;originHeight=573&amp;originWidth=567&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=158013&amp;status=done&amp;style=none&amp;taskId=u5e8a649d-a15f-4396-ba77-06b38a5f713&amp;title=&amp;width=567)
        :::

  4. 优点
     1. 一致性哈希算法的容错性
        :::info
        容错性
        假设Node C宕机，可以看到此时对象A、B、D不会受到影响，只有C对象被重定位到Node D。一般的，在一致性Hash算法中，如果一台服务器不可用，则受影响的数据仅仅是此服务器到其环空间中前一台服务器（即沿着逆时针方向行走遇到的第一台服务器）之间数据，其它不会受到影响。简单说，就是C挂了，受到影响的只是B、C之间的数据，并且这些数据会转移到D进行存储。
        ![image.png](https://cdn.nlark.com/yuque/0/2022/png/27791237/1658999941543-94276993-0b80-4c0d-8804-662831456bc2.png#averageHue=%23ebf0e7&amp;clientId=u7522598d-4755-4&amp;from=paste&amp;height=571&amp;id=u3c112a0d&amp;originHeight=571&amp;originWidth=563&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=161978&amp;status=done&amp;style=none&amp;taskId=u09f7be39-92ba-4496-b5d7-0ff60f9924f&amp;title=&amp;width=563)
        :::

     2. 一致性哈希算法的扩展性
        :::info
        数据量增加了，需要增加一台节点NodeX，X的位置在A和B之间，那收到影响的也就是A到X之间的数据，重新把A到X的数据录入到X上即可，
        不会导致hash取余全部数据重新洗牌。
        ![image.png](https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000035920-385ef89f-50cc-497a-9954-b91df3b4e84a.png#averageHue=%23eaf0e5&amp;clientId=u7522598d-4755-4&amp;from=paste&amp;height=571&amp;id=u966a44c0&amp;originHeight=571&amp;originWidth=563&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=174230&amp;status=done&amp;style=none&amp;taskId=u02e9c338-697d-421a-a4b8-d222c5003a3&amp;title=&amp;width=563)
        :::

  5. 缺点
</code></pre>
<p>一致性哈希算法的数据倾斜问题<br>:::info<br>Hash环的数据倾斜问题<br>一致性Hash算法在服务节点太少时，容易因为节点分布不均匀而造成数据倾斜（被缓存的对象大部分集中缓存在某一台服务器上）问题，<br>例如系统中只有两台服务器：<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000055531-fe1191aa-34b3-46d8-9981-b7ff2ad7f2a7.png#averageHue=%23aacaa2&clientId=u7522598d-4755-4&from=paste&height=366&id=u47cee6a4&originHeight=366&originWidth=354&originalType=binary&ratio=1&rotation=0&showTitle=false&size=37916&status=done&style=none&taskId=ub50eae90-1b60-412d-bb6f-aee3762664e&title=&width=354" alt="image.png"><br>:::</p>
<pre><code>  6. 小总结
     :::info
     为了在节点数目发生改变时尽可能少的迁移数据
     将所有的存储节点排列在收尾相接的Hash环上，每个key在计算Hash后会顺时针找到临近的存储节点存放。
     而当有节点加入或退出时仅影响该节点在Hash环上顺时针相邻的后续节点。  
     优点
     加入和删除节点只影响哈希环中顺时针方向的相邻的节点，对其他节点无影响。
     缺点 
     数据的分布和节点的位置有关，因为这些节点不是均匀的分布在哈希环上的，所以数据在进行存储时达不到均匀分布的效果。
     :::
</code></pre>
<ol start="7">
<li>哈希槽分区<ol>
<li><p>是什么<br>:::info<br>1 为什么出现<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000479815-61ec964c-ad1b-4a75-a379-a5aa680199f1.png#averageHue=%23b8ab9d&clientId=u7522598d-4755-4&from=paste&height=78&id=u0bb96f9b&originHeight=78&originWidth=505&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10751&status=done&style=none&taskId=u55bde246-7ce5-4740-af3c-006ee57ee3a&title=&width=505" alt="image.png"><br>哈希槽实质就是一个数组，数组[0,2^14 -1]形成hash slot空间。<br>2 能干什么<br>解决均匀分配的问题，在数据和节点之间又加入了一层，把这层称为哈希槽（slot），用于管理数据和节点之间的关系，现在就相当于节点上放的是槽，槽里放的是数据。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000487455-b7174e19-35ee-472e-8884-2fad95f1edbc.png#averageHue=%23f5ece9&clientId=u7522598d-4755-4&from=paste&height=148&id=u07316ff5&originHeight=148&originWidth=484&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12083&status=done&style=none&taskId=u10cf15a3-9899-43cd-97f9-7197617f3b2&title=&width=484" alt="image.png"><br>槽解决的是粒度问题，相当于把粒度变大了，这样便于数据移动。<br>哈希解决的是映射问题，使用key的哈希值来计算所在的槽，便于数据分配。<br>3 多少个hash槽<br>一个集群只能有16384个槽，编号0-16383（0-2^14-1）。这些槽会分配给集群中的所有主节点，分配策略没有要求。可以指定哪些编号的槽分配给哪个主节点。集群会记录节点和槽的对应关系。解决了节点和槽的关系后，接下来就需要对key求哈希值，然后对16384取余，余数是几key就落入对应的槽里。slot &#x3D; CRC16(key) % 16384。以槽为单位移动数据，因为槽的数目是固定的，处理起来比较容易，这样数据移动问题就解决了。<br>:::</p>
</li>
<li><p>哈希槽计算<br>:::info<br>Redis 集群中内置了 16384 个哈希槽，redis 会根据节点数量大致均等的将哈希槽映射到不同的节点。当需要在 Redis 集群中放置一个 key-value时，redis 先对 key 使用 crc16 算法算出一个结果，然后把结果对 16384 求余数，这样每个 key 都会对应一个编号在 0-16383 之间的哈希槽，也就是映射到某个节点上。如下代码，key之A 、B在Node2， key之C落在Node3上<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000531546-75739be6-1aee-4165-9dfb-6ac727deddf6.png#averageHue=%23f2ebea&clientId=u7522598d-4755-4&from=paste&height=280&id=u3fcdc2f2&originHeight=280&originWidth=402&originalType=binary&ratio=1&rotation=0&showTitle=false&size=44211&status=done&style=none&taskId=u76a967e4-d098-4e4e-9d6c-d1b99b826d2&title=&width=402" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1659000521473-2a5a3350-1bd4-4394-b4dd-496f4e024034.png#averageHue=%23faf8f6&clientId=u7522598d-4755-4&from=paste&height=220&id=ua57f8a40&originHeight=220&originWidth=661&originalType=binary&ratio=1&rotation=0&showTitle=false&size=24854&status=done&style=none&taskId=uf3ee8862-3580-474f-9600-49a37a088de&title=&width=661" alt="image.png"><br>:::</p>
</li>
</ol>
</li>
</ol>
<h3 id="1-2-2-3主3从redis集群扩缩容配置案例架构说明"><a href="#1-2-2-3主3从redis集群扩缩容配置案例架构说明" class="headerlink" title="1.2.2 3主3从redis集群扩缩容配置案例架构说明"></a>1.2.2 3主3从redis集群扩缩容配置案例架构说明</h3><p>见自己的processon笔记</p>
<h3 id="1-2-3-开打步骤"><a href="#1-2-3-开打步骤" class="headerlink" title="1.2.3 开打步骤"></a>1.2.3 开打步骤</h3><p>&#x2F;todo<br>3主3从redis集群配置<br>关闭防火墙+启动docker后台服务<br>systemctl start docker<br>新建6个docker容器redis实例<br>命令分步解释<br>docker run<br>创建并运行docker容器实例<br>–name redis-node-6<br>容器名字<br>–net host<br>使用宿主机的IP和端口，默认<br>–privileged&#x3D;true<br>获取宿主机root用户权限<br>-v &#x2F;data&#x2F;redis&#x2F;share&#x2F;redis-node-6:&#x2F;data<br>容器卷，宿主机地址:docker内部地址<br>redis:6.0.8<br>redis镜像和版本号<br>–cluster-enabled yes<br>开启redis集群<br>–appendonly yes<br>开启持久化<br>–port 6386<br>redis端口号<br>进入容器redis-node-1并为6台机器构建集群关系<br>进入容器<br>docker exec -it redis-node-1 &#x2F;bin&#x2F;bash<br>构建主从关系<br>一切OK的话，3主3从搞定<br>链接进入6381作为切入点，查看集群状态<br>链接进入6381作为切入点，查看节点状态<br>cluster info<br>cluster nodes<br>主从容错切换迁移案例<br>数据读写存储<br>启动6机构成的集群并通过exec进入<br>对6381新增两个key<br>防止路由失效加参数-c并新增两个key<br>查看集群信息<br>容错切换迁移<br>主6381和从机切换，先停止主机6381<br>6381主机停了，对应的真实从机上位<br>6381作为1号主机分配的从机以实际情况为准，具体是几号机器就是几号<br>再次查看集群信息<br>先还原之前的3主3从<br>先启6381<br>docker start redis-node-1<br>再停6385<br>docker stop redis-node-5<br>再启6385<br>docker start redis-node-5<br>主从机器分配情况以实际情况为准<br>查看集群状态<br>redis-cli –cluster check 自己IP:6381<br>主从扩容案例<br>新建6387、6388两个节点+新建后启动+查看是否8节点<br>进入6387容器实例内部<br>docker exec -it redis-node-7 &#x2F;bin&#x2F;bash<br>将新增的6387节点(空槽号)作为master节点加入原集群<br>检查集群情况第1次<br>重新分派槽号<br>检查集群情况第2次<br>槽号分派说明<br>为主节点6387分配从节点6388<br>检查集群情况第3次<br>主从缩容案例<br>目的：6387和6388下线<br>检查集群情况1获得6388的节点ID<br>将6388删除 从集群中将4号从节点6388删除<br>将6387的槽号清空，重新分配，本例将清出来的槽号都给6381<br>检查集群情况第二次<br>将6387删除<br>检查集群情况第三次</p>
<h1 id="2-DockerFile解析"><a href="#2-DockerFile解析" class="headerlink" title="2 DockerFile解析"></a>2 DockerFile解析</h1><h2 id="2-1-是什么"><a href="#2-1-是什么" class="headerlink" title="2.1 是什么"></a>2.1 是什么</h2><p>Dockerfile是用来构建Docker镜像的文本文件，是由一条条构建镜像所需的指令和参数构成的脚本。<br><strong>概述</strong><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660012864805-18937b87-0167-4c81-9d75-f485a61c5304.png#averageHue=%23e7e7e7&clientId=uecdeb63f-2bb2-4&from=paste&height=588&id=ub7136e0c&originHeight=588&originWidth=714&originalType=binary&ratio=1&rotation=0&showTitle=false&size=266947&status=done&style=none&taskId=u3f94e7d3-6f6d-4dcb-aacc-e6bcf371714&title=&width=714" alt="image.png"><br><strong>官网</strong><br><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a><br><strong>构建三步骤</strong></p>
<ol>
<li>编写Dockerfile文件</li>
<li>docker build 命令构建镜像</li>
<li>docker run 镜像 运行容器实例</li>
</ol>
<h2 id="2-2-DockerFile构建过程解析"><a href="#2-2-DockerFile构建过程解析" class="headerlink" title="2.2 DockerFile构建过程解析"></a>2.2 DockerFile构建过程解析</h2><h3 id="2-2-1-Dockerfile内容基础知识"><a href="#2-2-1-Dockerfile内容基础知识" class="headerlink" title="2.2.1 Dockerfile内容基础知识"></a>2.2.1 Dockerfile内容基础知识</h3><ol>
<li>每条保留字指令都必须为大写字母且后面要跟随至少一个参数</li>
<li>指令按照从上到下，顺序执行</li>
<li>#表示注释</li>
<li>每条指令都会创建一个新的镜像层并对镜像进行提交</li>
</ol>
<h3 id="2-2-2-Docker执行Dockerfile的大致流程"><a href="#2-2-2-Docker执行Dockerfile的大致流程" class="headerlink" title="2.2.2 Docker执行Dockerfile的大致流程"></a>2.2.2 Docker执行Dockerfile的大致流程</h3><ol>
<li>docker从基础镜像运行一个容器</li>
<li>执行一条指令并对容器作出修改</li>
<li>执行类似docker commit的操作提交一个新的镜像层</li>
<li>docker再基于刚提交的镜像运行一个新容器</li>
<li>执行dockerfile中的下一条指令直到所有指令都执行完成</li>
</ol>
<h3 id="2-2-3-小总结"><a href="#2-2-3-小总结" class="headerlink" title="2.2.3 小总结"></a>2.2.3 小总结</h3><p>:::info<br>从应用软件的角度来看，Dockerfile、Docker镜像与Docker容器分别代表软件的三个不同阶段，</p>
<ul>
<li>Dockerfile是软件的原材料</li>
<li>Docker镜像是软件的交付品</li>
<li>Docker容器则可以认为是软件镜像的运行态，也即依照镜像运行的容器实例</li>
</ul>
<p>Dockerfile面向开发，Docker镜像成为交付标准，Docker容器则涉及部署与运维，三者缺一不可，合力充当Docker体系的基石。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013094449-a1af09f8-c696-4f09-a5de-6ee1844fb424.png#averageHue=%239dc3e3&clientId=uecdeb63f-2bb2-4&from=paste&height=265&id=ua777348d&originHeight=265&originWidth=622&originalType=binary&ratio=1&rotation=0&showTitle=false&size=87764&status=done&style=none&taskId=udfd725c2-21ca-44f3-9622-71a7a86a049&title=&width=622" alt="image.png"></p>
<ol>
<li>Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西。Dockerfile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程(当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制)等等;</li>
<li>Docker镜像，在用Dockerfile定义一个文件之后，docker build时会产生一个Docker镜像，当运行 Docker镜像时会真正开始提供服务;</li>
<li>Docker容器，容器是直接提供服务的。<br>:::</li>
</ol>
<h2 id="2-3-DockerFile常用保留字指令"><a href="#2-3-DockerFile常用保留字指令" class="headerlink" title="2.3 DockerFile常用保留字指令"></a>2.3 DockerFile常用保留字指令</h2><p><strong>参考tomcat8的dockerfile入门</strong><br><a target="_blank" rel="noopener" href="https://github.com/docker-library/tomcat">https://github.com/docker-library/tomcat</a><br><strong>FROM</strong><br>基础镜像，当前新镜像是基于哪个镜像的，指定一个已经存在的镜像作为模板，第一条必须是from</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># FROM 镜像名</span></span><br><span class="line">FROM hub.c.<span class="number">163</span>.com/library/tomcat</span><br></pre></td></tr></table></figure>

<p><strong>MAINTAINER</strong><br>镜像维护者的姓名和邮箱地址</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 非必须</span></span><br><span class="line">MAINTAINER ZhangSan zs@<span class="number">163</span>.com</span><br></pre></td></tr></table></figure>

<p><strong>RUN</strong><br>容器构建时需要运行的命令<br>两种格式<br>:::info</p>
<ol>
<li>shell格式</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013238837-86e640c5-49ef-424a-81d0-bc702f35389b.png#averageHue=%23f4f0f0&clientId=uecdeb63f-2bb2-4&from=paste&height=82&id=FhAfL&originHeight=82&originWidth=487&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2900&status=done&style=none&taskId=u6b6c7841-417b-4761-a3a3-1ab54d39244&title=&width=487" alt="image.png"><br><code>RUN yum -y install vim</code></p>
<ol start="2">
<li>exec格式</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013257101-5b63a752-99eb-4678-b2de-a527717ccbcc.png#averageHue=%23f5f3f3&clientId=uecdeb63f-2bb2-4&from=paste&height=108&id=okgom&originHeight=108&originWidth=688&originalType=binary&ratio=1&rotation=0&showTitle=false&size=5642&status=done&style=none&taskId=ube7008f1-7674-4c0a-96e5-e9e2f0262bd&title=&width=688" alt="image.png"><br>:::<br>RUN是在 docker build时运行<br><strong>EXPOSE</strong><br>当前容器对外暴露出的端口</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EXPOSE 要暴露的端口</span></span><br><span class="line"><span class="comment"># EXPOSE &lt;port&gt;[/&lt;protocol] ....</span></span><br><span class="line">EXPOSE <span class="number">3306</span> <span class="number">33060</span></span><br></pre></td></tr></table></figure>

<p><strong>WORKDIR</strong><br>指定在创建容器后，终端默认登陆的进来工作目录，一个落脚点</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ENV CATALINA_HOME /usr/local/tomcat</span><br><span class="line">WORKDIR <span class="variable">$CATALINA_HOME</span></span><br></pre></td></tr></table></figure>

<p><strong>USER</strong><br>指定该镜像以什么样的用户去执行，如果都不指定，默认是root</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># USER &lt;user&gt;[:&lt;group&gt;]</span></span><br><span class="line">USER patrick</span><br></pre></td></tr></table></figure>

<p><strong>ENV</strong><br>用来在构建镜像过程中设置环境变量<br>:::info</p>
<h1 id="格式-ENV-环境变量名-环境变量值"><a href="#格式-ENV-环境变量名-环境变量值" class="headerlink" title="格式 ENV 环境变量名 环境变量值"></a>格式 ENV 环境变量名 环境变量值</h1><h1 id="或者-ENV-环境变量名-值"><a href="#或者-ENV-环境变量名-值" class="headerlink" title="或者 ENV 环境变量名&#x3D;值"></a>或者 ENV 环境变量名&#x3D;值</h1><p><code>ENV MY_PATH /usr/mytest</code><br>这个环境变量可以在后续的任何RUN指令中使用，这就如同在命令前面指定了环境变量前缀一样；<br>也可以在其它指令中直接使用这些环境变量。<br>比如：<code>WORKDIR $MY_PATH</code><br>:::<br><strong>ADD</strong><br>将宿主机目录下的文件拷贝进镜像且会自动处理URL和解压tar压缩包<br><strong>COPY</strong><br>类似ADD，拷贝文件和目录到镜像中。<br>将从构建上下文目录中 &lt;源路径&gt; 的文件&#x2F;目录复制到新的一层的镜像内的 &lt;目标路径&gt; 位置<br>:::info<br><code>COPY src dest</code><br><code>COPY [&quot;src&quot;, &quot;dest&quot;]</code><br>&lt;src源路径&gt;：源文件或者源目录<br>&lt;dest目标路径&gt;：容器内的指定路径，该路径不用事先建好，路径不存在的话，会自动创建。<br>:::<br><strong>VOLUME</strong><br>容器数据卷，用于数据保存和持久化工作.类似于 <code>docker run</code> 的<code>-v</code>参数。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VOLUME 挂载点</span></span><br><span class="line"><span class="comment"># 挂载点可以是一个路径，也可以是数组（数组中的每一项必须用双引号）</span></span><br><span class="line">VOLUME /var/lib/mysql</span><br></pre></td></tr></table></figure>

<p><strong>CMD</strong></p>
<p>指定容器启动后要干的事情。<br>有两种格式：</p>
<ul>
<li>shell格式</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMD &lt;命令&gt;</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;hello world&quot;</span></span></span><br></pre></td></tr></table></figure>


<ul>
<li>exec格式</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMD [&quot;可执行文件&quot;, &quot;参数1&quot;, &quot;参数2&quot; ...]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;catalina.sh&quot;</span>, <span class="string">&quot;run&quot;</span>]</span></span><br></pre></td></tr></table></figure>


<ul>
<li>参数列表格式</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMD [&quot;参数1&quot;, &quot;参数2&quot; ....]，与ENTRYPOINT指令配合使用</span></span><br></pre></td></tr></table></figure>

<p>Dockerfile中如果出现多个<code>CMD</code>指令，只有最后一个生效。<code>CMD</code>会被<code>docker run</code>之后的参数替换。</p>
<p>例如，对于tomcat镜像，执行以下命令会有不同的效果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">因为tomcat的Dockerfile中指定了 CMD [<span class="string">&quot;catalina.sh&quot;</span>, <span class="string">&quot;run&quot;</span>]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">所以直接docker run 时，容器启动后会自动执行 catalina.sh run</span></span><br><span class="line">docker run -it -p 8080:8080 tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定容器启动后执行 /bin/bash</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此时指定的/bin/bash会覆盖掉Dockerfile中指定的 CMD [<span class="string">&quot;catalina.sh&quot;</span>, <span class="string">&quot;run&quot;</span>]</span></span><br><span class="line">docker run -it -p 8080:8080 tomcat /bin/bash</span><br></pre></td></tr></table></figure>

<p><code>CMD</code>是在<code>docker run</code>时运行，而 <code>RUN</code>是在<code>docker build</code>时运行。</p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><strong>ENTRYPOINT</strong><br>用来指定一个容器启动时要运行的命令。</p>
<p>类似于<code>CMD</code>命令，但是<code>ENTRYPOINT</code>不会被<code>docker run</code>后面的命令覆盖，这些命令参数会被当做参数送给<code>ENTRYPOINT</code>指令指定的程序。</p>
<p><code>ENTRYPOINT</code>可以和<code>CMD</code>一起用，一般是可变参数才会使用<code>CMD</code>，这里的<code>CMD</code>等于是在给<code>ENTRYPOINT</code>传参。</p>
<p>当指定了<code>ENTRYPOINT</code>后，<code>CMD</code>的含义就发生了变化，不再是直接运行期命令，而是将<code>CMD</code>的内容作为参数传递给<code>ENTRYPOINT</code>指令，它们两个组合会变成 <code>&lt;ENTRYPOINT&gt; &quot;&lt;CMD&gt;&quot;</code>。</p>
<p>例如：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nginx</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;-c&quot;</span>]  <span class="comment"># 定参</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/etc/nginx/nginx.conf&quot;</span>] <span class="comment"># 变参</span></span></span><br></pre></td></tr></table></figure>

<p>:::info<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013973533-8d49c0c9-0ea4-45a0-b2e3-14d3f28a33a0.png#averageHue=%23f1eeec&clientId=uecdeb63f-2bb2-4&from=paste&height=149&id=aAeFw&originHeight=149&originWidth=584&originalType=binary&ratio=1&rotation=0&showTitle=false&size=52126&status=done&style=none&taskId=u29df7d1a-03e1-410c-bab9-36983e741d8&title=&width=584" alt="image.png"><br>:::<br>对于此Dockerfile，构建成镜像 <code>nginx:test</code>后，如果执行；</p>
<ul>
<li><code>docker run nginx test</code>，则容器启动后，会执行 <code>nginx -c /etc/nginx/nginx.conf</code></li>
<li><code>docker run nginx:test /app/nginx/new.conf</code>，则容器启动后，会执行 <code>nginx -c /app/nginx/new.conf</code></li>
</ul>
<p>优点：在执行docker run的时候可以指定 ENTRYPOINT 运行所需的参数。<br>注意：如果 Dockerfile 中如果存在多个 ENTRYPOINT 指令，仅最后一个生效。</p>
<p><strong>扩展指令</strong></p>
<p>**ARG:**设置变量，在镜像中定义一个变量，当使用 docker build 命令构建镜像时，带上 –build-arg <name>&#x3D;<value> 来指定参数值，如果该变量名在 Dockerfile 中不存在则会抛出一个警告<br>语法：<br>ARG <name>[&#x3D;<default value>]</p>
<p><strong>ONBUILD</strong>:表示在构建镜像时做某操作，不过不对当前 Dockerfile 的镜像生效，而是对以当前 Dockerfile 镜像作为基础镜像的子镜像生效</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line"><span class="keyword">ONBUILD</span> [INSTRUCTION]</span><br><span class="line"></span><br><span class="line">例：</span><br><span class="line">当前镜像为 A，设置了如下指令 </span><br><span class="line"><span class="keyword">ONBUILD</span> <span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">ls</span> -al</span></span><br><span class="line"></span><br><span class="line">镜像 B：</span><br><span class="line"><span class="keyword">FROM</span> 镜像A</span><br></pre></td></tr></table></figure>

<p><strong>小总结</strong><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660013999567-eea06f1d-f9ac-425e-a851-c5dda92b5ce5.png#averageHue=%23101010&clientId=uecdeb63f-2bb2-4&from=paste&height=465&id=ub146be77&originHeight=465&originWidth=676&originalType=binary&ratio=1&rotation=0&showTitle=false&size=59099&status=done&style=none&taskId=ufa6f83e7-cad6-45cf-aecc-10067ecea96&title=&width=676" alt="image.png"></p>
<h2 id="-1"><a href="#-1" class="headerlink" title=""></a></h2><h1 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h1><p>创建名称为<code>Dockerfile</code>的文件，示例：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"></span><br><span class="line"><span class="comment"># 描述镜像的作者，及联系方式（可选）</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> lee&lt;lee@xxx.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 镜像的标签信息（可选）</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> version=<span class="string">&quot;1.0&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> description=<span class="string">&quot;这是我的Dockerfile&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 环境变量</span></span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$MYPATH</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install net-tools</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;install ifconfig cmd into ubuntu success .....&quot;</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /bin/bash</span></span><br></pre></td></tr></table></figure>

<p>编写完成之后，将其构建成docker镜像。<br>命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意：定义的TAG后面有个空格，空格后面有个点</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker build -t 新镜像名字:TAG .</span></span><br><span class="line">docker build -t ubuntu:1.0.1 .</span><br></pre></td></tr></table></figure>

<h3 id="springboot项目镜像构建"><a href="#springboot项目镜像构建" class="headerlink" title="springboot项目镜像构建"></a>springboot项目镜像构建</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> opnejdk:<span class="number">8</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="虚悬镜像"><a href="#虚悬镜像" class="headerlink" title="虚悬镜像"></a>虚悬镜像</h1><p>虚悬镜像：仓库名、标签名都是 <code>&lt;none&gt;</code>的镜像，称为 dangling images（虚悬镜像）。<br>在构建或者删除镜像时可能由于一些错误导致出现虚悬镜像。</p>
<p>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建时候没有镜像名、tag</span></span><br><span class="line">docker build .</span><br></pre></td></tr></table></figure>

<p>列出docker中的虚悬镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image ls -f dangling=true</span><br></pre></td></tr></table></figure>

<p>虚悬镜像一般是因为一些错误而出现的，没有存在价值，可以删除：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除所有的虚悬镜像</span></span><br><span class="line">docker image prune</span><br></pre></td></tr></table></figure>

<h2 id="2-4-案例"><a href="#2-4-案例" class="headerlink" title="2.4 案例"></a>2.4 案例</h2><h3 id="2-4-1-自定义镜像mycentosjava8"><a href="#2-4-1-自定义镜像mycentosjava8" class="headerlink" title="2.4.1 自定义镜像mycentosjava8"></a>2.4.1 自定义镜像mycentosjava8</h3><p><strong>要求</strong><br>Centos7镜像具备vim+ifconfig+jdk8<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014531015-748a0daa-758a-44ea-9496-34d5e34810e0.png#clientId=uecdeb63f-2bb2-4&from=paste&height=227&id=u341e5a6e&originHeight=227&originWidth=877&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30417&status=done&style=none&taskId=u8a4e5af5-4c8c-4f5f-a648-ce53094414e&title=&width=877" alt="image.png"><br>JDK的下载镜像地址：<a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/downloads/#java8">https://www.oracle.com/java/technologies/downloads/#java8</a><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014469696-1c74ba76-2119-4031-8337-4ab9880aec14.png#clientId=uecdeb63f-2bb2-4&from=paste&height=422&id=uf7fbc99a&originHeight=422&originWidth=1225&originalType=binary&ratio=1&rotation=0&showTitle=false&size=68048&status=done&style=none&taskId=u48ea17e9-0d97-4143-90e3-e282cabe913&title=&width=1225" alt="image.png"><br><a target="_blank" rel="noopener" href="https://mirrors.yangxingzhen.com/jdk/">https://mirrors.yangxingzhen.com/jdk/</a><br><strong>编写</strong><br>准备编写Dockerfile文件</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">MAINTAINER</span> zzyy&lt;zzyybs@<span class="number">126</span>.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$MYPATH</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装vim编辑器</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install vim</span></span><br><span class="line"><span class="comment">#安装ifconfig命令查看网络IP</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install net-tools</span></span><br><span class="line"><span class="comment">#安装java8及lib库</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum -y install glibc.i686</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> /usr/local/java</span></span><br><span class="line"><span class="comment">#ADD 是相对路径jar,把jdk-8u171-linux-x64.tar.gz添加到容器中,安装包必须要和Dockerfile文件在同一位置</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> jdk-8u171-linux-x64.tar.gz /usr/local/java/</span></span><br><span class="line"><span class="comment">#配置java环境变量</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/local/java/jdk1.<span class="number">8.0</span>_171</span><br><span class="line"><span class="keyword">ENV</span> JRE_HOME $JAVA_HOME/jre</span><br><span class="line"><span class="keyword">ENV</span> CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH</span><br><span class="line"><span class="keyword">ENV</span> PATH $JAVA_HOME/bin:$PATH</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;success--------------ok&quot;</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /bin/bash</span></span><br></pre></td></tr></table></figure>

<p>大写字母D<br><strong>构建</strong><br>docker build -t 新镜像名字:TAG .<br><code>docker build -t centosjava8:1.5 .</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014597535-9bd29a0a-3a5e-4e51-bad4-df136dd6c0fd.png#clientId=uecdeb63f-2bb2-4&from=paste&height=470&id=u5e9ac419&originHeight=470&originWidth=655&originalType=binary&ratio=1&rotation=0&showTitle=false&size=85342&status=done&style=none&taskId=ua5070006-02f9-44aa-a7a8-0126e1cbc23&title=&width=655" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014603485-ae9f7bae-798e-4538-9a35-05ddd6226cc5.png#clientId=uecdeb63f-2bb2-4&from=paste&height=425&id=ud57137f0&originHeight=425&originWidth=577&originalType=binary&ratio=1&rotation=0&showTitle=false&size=78362&status=done&style=none&taskId=u70d2d325-7a65-4acd-ba8d-13f877bdfa5&title=&width=577" alt="image.png"><br>注意，上面TAG后面有个空格，有个点<br><strong>运行</strong><br>docker run -it 新镜像名字:TAG<br><code>docker run -it centosjava8:1.5 /bin/bash</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014631293-415ef8b0-d5c7-4107-9c47-19b58f568931.png#clientId=uecdeb63f-2bb2-4&from=paste&height=492&id=ueb67b89d&originHeight=492&originWidth=886&originalType=binary&ratio=1&rotation=0&showTitle=false&size=110766&status=done&style=none&taskId=u26412c08-2aa5-43cf-8a67-301b22b25e6&title=&width=886" alt="image.png"><br><strong>再体会下UnionFS（联合文件系统）</strong><br>:::info<br>UnionFS（联合文件系统）：Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtual filesystem)。Union 文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014653132-0f14d9d0-133d-436f-93ec-4a4dc6625ff4.png#clientId=uecdeb63f-2bb2-4&from=paste&height=314&id=u96a71337&originHeight=314&originWidth=526&originalType=binary&ratio=1&rotation=0&showTitle=false&size=246350&status=done&style=none&taskId=u68db3563-c336-43f5-81c3-e7832477f3c&title=&width=526" alt="image.png"><br>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录<br>:::</p>
<h3 id="2-4-2-虚悬镜像"><a href="#2-4-2-虚悬镜像" class="headerlink" title="2.4.2 虚悬镜像"></a>2.4.2 虚悬镜像</h3><p><strong>是什么</strong><br>仓库名、标签都是<none>的镜像，俗称dangling image<br>Dockerfile写一个</p>
<ol>
<li><code>vim Dockerfile</code></li>
</ol>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ubuntu</span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&#x27;action is success&#x27;</span></span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>docker build .</code></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014736138-8bb82a47-f06e-458d-b445-24077db9bdcd.png#averageHue=%23fef4f4&clientId=uecdeb63f-2bb2-4&from=paste&height=88&id=u4e7f17d5&originHeight=88&originWidth=932&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20888&status=done&style=none&taskId=uce7fde95-9177-4fc0-a268-99ab383229d&title=&width=932" alt="image.png"><br><strong>查看</strong><br><code>docker image ls -f dangling=true</code><br>命令结果<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014743652-1ed51439-61d8-4641-b75d-529e8bc74eb6.png#averageHue=%23fdf0f0&clientId=uecdeb63f-2bb2-4&from=paste&height=105&id=u1b06cae5&originHeight=105&originWidth=775&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18879&status=done&style=none&taskId=u970b039b-ea17-48cf-80be-c5e081c1d64&title=&width=775" alt="image.png"><br><strong>删除</strong><br><code>docker image prune</code><br>虚悬镜像已经失去存在价值，可以删除<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014763642-61295eb3-d313-4f8b-873c-ca674dff3b4d.png#averageHue=%23fef9f9&clientId=uecdeb63f-2bb2-4&from=paste&height=308&id=u6ec8ee00&originHeight=308&originWidth=886&originalType=binary&ratio=1&rotation=0&showTitle=false&size=59960&status=done&style=none&taskId=u6c8cf1f1-4acd-4476-92ef-6d896cf258f&title=&width=886" alt="image.png"></p>
<h3 id="2-4-3-家庭作业-自定义镜像myubuntu"><a href="#2-4-3-家庭作业-自定义镜像myubuntu" class="headerlink" title="2.4.3 家庭作业-自定义镜像myubuntu"></a>2.4.3 家庭作业-自定义镜像myubuntu</h3><p><strong>编写</strong><br>准备编写DockerFile文件<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014788578-6dfe4fa8-d48d-402a-8c88-0ec91503aa7a.png#averageHue=%23f3e6e6&clientId=uecdeb63f-2bb2-4&from=paste&height=98&id=ua61d1e8a&originHeight=98&originWidth=533&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7916&status=done&style=none&taskId=u9c7619e0-f815-4480-9c47-7a19dcce72b&title=&width=533" alt="image.png"></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">MAINTAINER</span> zzyy&lt;zzyybs@<span class="number">126</span>.com&gt;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$MYPATH</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install net-tools</span></span><br><span class="line"><span class="comment">#RUN apt-get install -y iproute2</span></span><br><span class="line"><span class="comment">#RUN apt-get install -y inetutils-ping</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;install inconfig cmd into ubuntu success--------------ok&quot;</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /bin/bash</span></span><br></pre></td></tr></table></figure>

<p><strong>构建</strong><br><code>docker build -t 新镜像名字:TAG .</code><br><strong>运行</strong><br><code>docker run -it 新镜像名字:TAG</code></p>
<h2 id="2-5-小总结"><a href="#2-5-小总结" class="headerlink" title="2.5 小总结"></a>2.5 小总结</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1660014827592-6677a045-601e-40ae-b864-752c300a67ec.png#averageHue=%23e7e7e7&clientId=uecdeb63f-2bb2-4&from=paste&height=588&id=u1e55d397&originHeight=588&originWidth=714&originalType=binary&ratio=1&rotation=0&showTitle=false&size=266947&status=done&style=none&taskId=u6d063671-b38d-4182-8539-5221cfed4f1&title=&width=714" alt="image.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://tuanliang.github.io">十一</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://tuanliang.github.io/2024/04/28/docker-3/">https://tuanliang.github.io/2024/04/28/docker-3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://tuanliang.github.io" target="_blank">十一的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Docker/">Docker</a></div><div class="post_share"><div class="social-share" data-image="/image/spring.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/04/29/docker%E7%BD%91%E7%BB%9C-dockercompose/" title="docker网络_docker-compose"><img class="cover" src="/image/bike.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">docker网络_docker-compose</div></div></a></div><div class="next-post pull-right"><a href="/2024/04/27/docker-2/" title="docker_2"><img class="cover" src="/image/zhongguofeng.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">docker_2</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/04/25/docker-1/" title="docker_1"><img class="cover" src="/image/yewanshu.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-25</div><div class="title">docker_1</div></div></a></div><div><a href="/2024/04/29/docker%E7%BD%91%E7%BB%9C-dockercompose/" title="docker网络_docker-compose"><img class="cover" src="/image/bike.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-29</div><div class="title">docker网络_docker-compose</div></div></a></div><div><a href="/2024/04/27/docker-2/" title="docker_2"><img class="cover" src="/image/zhongguofeng.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-27</div><div class="title">docker_2</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/image/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">十一</div><div class="author-info__description">归途也还可爱</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">47</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/tuanliang"><i class="fab fa-github"></i><span>关注我</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">个人简历在关于笔者一栏~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Docker%E5%A4%8D%E6%9D%82%E5%AE%89%E8%A3%85%E8%AF%A6%E8%AF%B4"><span class="toc-number">1.</span> <span class="toc-text">1 Docker复杂安装详说</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%AE%89%E8%A3%85MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 安装MySQL主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-1-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1.1 主从复制原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-2-%E4%B8%BB%E4%BB%8E%E6%90%AD%E5%BB%BA%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.1.2 主从搭建步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%AE%89%E8%A3%85redis%E9%9B%86%E7%BE%A4-%E5%A4%A7%E5%8E%82%E9%9D%A2%E8%AF%95%E9%A2%98%E7%AC%AC4%E5%AD%A3-%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E6%A1%88%E4%BE%8B%E7%9C%9F%E9%A2%98"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 安装redis集群(大厂面试题第4季-分布式存储案例真题)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 面试题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-3%E4%B8%BB3%E4%BB%8Eredis%E9%9B%86%E7%BE%A4%E6%89%A9%E7%BC%A9%E5%AE%B9%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B%E6%9E%B6%E6%9E%84%E8%AF%B4%E6%98%8E"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2 3主3从redis集群扩缩容配置案例架构说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-%E5%BC%80%E6%89%93%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.2.3 开打步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-DockerFile%E8%A7%A3%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">2 DockerFile解析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-DockerFile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%E8%A7%A3%E6%9E%90"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 DockerFile构建过程解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-Dockerfile%E5%86%85%E5%AE%B9%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 Dockerfile内容基础知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-Docker%E6%89%A7%E8%A1%8CDockerfile%E7%9A%84%E5%A4%A7%E8%87%B4%E6%B5%81%E7%A8%8B"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 Docker执行Dockerfile的大致流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-%E5%B0%8F%E6%80%BB%E7%BB%93"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.2.3 小总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-DockerFile%E5%B8%B8%E7%94%A8%E4%BF%9D%E7%95%99%E5%AD%97%E6%8C%87%E4%BB%A4"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 DockerFile常用保留字指令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F-ENV-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%90%8D-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%80%BC"><span class="toc-number">3.</span> <span class="toc-text">格式 ENV 环境变量名 环境变量值</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%88%96%E8%80%85-ENV-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%90%8D-%E5%80%BC"><span class="toc-number">4.</span> <span class="toc-text">或者 ENV 环境变量名&#x3D;值</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">4.1.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-1"><span class="toc-number">4.2.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="toc-number">5.</span> <span class="toc-text">构建镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#springboot%E9%A1%B9%E7%9B%AE%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA"><span class="toc-number">5.0.1.</span> <span class="toc-text">springboot项目镜像构建</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%99%9A%E6%82%AC%E9%95%9C%E5%83%8F"><span class="toc-number">6.</span> <span class="toc-text">虚悬镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E6%A1%88%E4%BE%8B"><span class="toc-number">6.1.</span> <span class="toc-text">2.4 案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8Fmycentosjava8"><span class="toc-number">6.1.1.</span> <span class="toc-text">2.4.1 自定义镜像mycentosjava8</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-%E8%99%9A%E6%82%AC%E9%95%9C%E5%83%8F"><span class="toc-number">6.1.2.</span> <span class="toc-text">2.4.2 虚悬镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-3-%E5%AE%B6%E5%BA%AD%E4%BD%9C%E4%B8%9A-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8Fmyubuntu"><span class="toc-number">6.1.3.</span> <span class="toc-text">2.4.3 家庭作业-自定义镜像myubuntu</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E5%B0%8F%E6%80%BB%E7%BB%93"><span class="toc-number">6.2.</span> <span class="toc-text">2.5 小总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/08/30/JS%E9%AB%98%E7%BA%A7-Proxy-Reflect%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/" title="JS高级-Proxy_Reflect使用详解"><img src="/image/flower.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JS高级-Proxy_Reflect使用详解"/></a><div class="content"><a class="title" href="/2024/08/30/JS%E9%AB%98%E7%BA%A7-Proxy-Reflect%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/" title="JS高级-Proxy_Reflect使用详解">JS高级-Proxy_Reflect使用详解</a><time datetime="2024-08-30T13:49:13.000Z" title="发表于 2024-08-30 21:49:13">2024-08-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/30/ES6-ES13%E6%96%B0%E7%89%B9%E6%80%A73/" title="ES6~ES13新特性3"><img src="/image/fangao.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ES6~ES13新特性3"/></a><div class="content"><a class="title" href="/2024/08/30/ES6-ES13%E6%96%B0%E7%89%B9%E6%80%A73/" title="ES6~ES13新特性3">ES6~ES13新特性3</a><time datetime="2024-08-30T07:49:34.000Z" title="发表于 2024-08-30 15:49:34">2024-08-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/30/ES6-ES13%E6%96%B0%E7%89%B9%E6%80%A72/" title="ES6~ES13新特性2"><img src="/image/bike.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ES6~ES13新特性2"/></a><div class="content"><a class="title" href="/2024/08/30/ES6-ES13%E6%96%B0%E7%89%B9%E6%80%A72/" title="ES6~ES13新特性2">ES6~ES13新特性2</a><time datetime="2024-08-30T07:49:21.000Z" title="发表于 2024-08-30 15:49:21">2024-08-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/28/JS%E9%AB%98%E7%BA%A7-ES13%E6%96%B0%E7%89%B9%E6%80%A71/" title="JS高级-ES13新特性1"><img src="/image/45663c9f2ce54eb2ae8628efb0c43390.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JS高级-ES13新特性1"/></a><div class="content"><a class="title" href="/2024/08/28/JS%E9%AB%98%E7%BA%A7-ES13%E6%96%B0%E7%89%B9%E6%80%A71/" title="JS高级-ES13新特性1">JS高级-ES13新特性1</a><time datetime="2024-08-28T02:43:57.000Z" title="发表于 2024-08-28 10:43:57">2024-08-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/28/JS%E9%AB%98%E7%BA%A7-ES6%E5%AE%9E%E7%8E%B0%E7%BB%A7%E6%89%BF/" title="JS高级-ES6实现继承"><img src="/image/zhongguofeng.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JS高级-ES6实现继承"/></a><div class="content"><a class="title" href="/2024/08/28/JS%E9%AB%98%E7%BA%A7-ES6%E5%AE%9E%E7%8E%B0%E7%BB%A7%E6%89%BF/" title="JS高级-ES6实现继承">JS高级-ES6实现继承</a><time datetime="2024-08-28T02:43:16.000Z" title="发表于 2024-08-28 10:43:16">2024-08-28</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/image/spring.png')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024  <i id="heartbeat" class="fa fas fa-heartbeat"></i> 十一</div><div class="footer_custom_text">十一的博客</div></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'ws2gX4Ds7Q3br3Z7ORXNr3NI-gzGzoHsz',
      appKey: 'NLF6z82Nd60EfdSBbPEPM0J3',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, {"placeholder":"评论一下"}))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.jsdelivr.net/npm/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !true) {
    if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script src="/style/js/custom.js"></script><script async src="/style/js/categoryBar.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'a4a0a2a7266d411881101f0fce4b32ec';
  var gaud_map_key = '3dd03960aa863fc05ac90b405bf769b1';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/04/22/spring-aop、事务/" alt=""><img width="48" height="48" src="/image/walk.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-04-22</span><a class="blog-slider__title" href="2024/04/22/spring-aop、事务/" alt="">spring_aop、事务</a><div class="blog-slider__text">这是显示在首页的概述，正文内容均会被隐藏。</div><a class="blog-slider__button" href="2024/04/22/spring-aop、事务/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/04/29/docker网络-dockercompose/" alt=""><img width="48" height="48" src="/image/bike.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-04-29</span><a class="blog-slider__title" href="2024/04/29/docker网络-dockercompose/" alt="">docker网络_docker-compose</a><div class="blog-slider__text">这是显示在首页的概述，正文内容均会被隐藏。</div><a class="blog-slider__button" href="2024/04/29/docker网络-dockercompose/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/06/25/软考高级系统架构师通过/" alt=""><img width="48" height="48" src="/image/spring.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-06-25</span><a class="blog-slider__title" href="2024/06/25/软考高级系统架构师通过/" alt="">软考高级系统架构师通过</a><div class="blog-slider__text">生活随笔</div><a class="blog-slider__button" href="2024/06/25/软考高级系统架构师通过/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><!-- hexo injector body_end end --></body></html>