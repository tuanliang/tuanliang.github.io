<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>docker_2 | 十一的博客</title><meta name="author" content="十一"><meta name="copyright" content="十一"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="这是显示在首页的概述，正文内容均会被隐藏。">
<meta property="og:type" content="article">
<meta property="og:title" content="docker_2">
<meta property="og:url" content="https://tuanliang.github.io/2024/04/27/docker-2/index.html">
<meta property="og:site_name" content="十一的博客">
<meta property="og:description" content="这是显示在首页的概述，正文内容均会被隐藏。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tuanliang.github.io/image/zhongguofeng.jpg">
<meta property="article:published_time" content="2024-04-27T12:08:20.000Z">
<meta property="article:modified_time" content="2024-04-27T12:10:51.770Z">
<meta property="article:author" content="十一">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tuanliang.github.io/image/zhongguofeng.jpg"><link rel="shortcut icon" href="/image/sharpicons_Cheetah.png"><link rel="canonical" href="https://tuanliang.github.io/2024/04/27/docker-2/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'docker_2',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-27 20:10:51'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/style/css/custom.css"><link rel="stylesheet" href="/style/css/iconfont.css"><link rel="stylesheet" type="text/css" href="/style/css/heoMainColor.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css" /><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/image/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">52</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><meta name="referrer" content="no-referrer"><header class="post-bg" id="page-header" style="background-image: url('/image/zhongguofeng.jpg')"><nav id="nav"><div id="nav-group"><span id="blog-info"><a href="/" title="十一的博客"><img class="site-icon" src="/image/sharpicons_Cheetah.png"/><span class="site-name">十一的博客</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div><div id="nav-right"><div id="search-button"><a class="site-page social-icon search"><i class="iconfont icat-search"></i></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="搜索本站文章"><i class="iconfont icat-bars"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">docker_2</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-04-27T12:08:20.000Z" title="发表于 2024-04-27 20:08:20">2024-04-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-27T12:10:51.770Z" title="更新于 2024-04-27 20:10:51">2024-04-27</time></span></div><div class="meta-secondline"><span class="post-meta-categories"><i class="iconfont icat-categories fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Docker/">Docker</a></span><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">13.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>75分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="docker_2"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:<section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="4-Docker镜像"><a href="#4-Docker镜像" class="headerlink" title="4 Docker镜像"></a>4 Docker镜像</h1><h3 id="4-1-是什么"><a href="#4-1-是什么" class="headerlink" title="4.1 是什么"></a>4.1 是什么</h3><p>是一种轻量级、可执行的独立软件包，它包含运行某个软件所需的所有内容，我们把应用程序和配置依赖打包好形成一个可交付的运行环境(包括代码、运行时需要的库、环境变量和配置文件等)，这个打包好的运行环境就是image镜像文件。<br>只有通过这个镜像文件才能生成Docker容器实例(类似Java中new出来一个对象)。</p>
<h4 id="4-1-1-分层的镜像"><a href="#4-1-1-分层的镜像" class="headerlink" title="4.1.1 分层的镜像"></a>4.1.1 分层的镜像</h4><p>以我们的pull为例，在下载的过程中我们可以看到docker的镜像好像是在一层一层的在下载<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139351043-7a36850b-bd26-491a-9597-76535f2b0a1f.png#averageHue=%23f5f4f4&clientId=uc7bc2b35-0cbd-4&from=paste&height=391&id=u6680eff7&originHeight=391&originWidth=698&originalType=binary&ratio=1&rotation=0&showTitle=false&size=113408&status=done&style=none&taskId=u7a311554-4116-4b63-bc4f-225b77f45d4&title=&width=698" alt="image.png"></p>
<h4 id="4-1-2-UnionFS（联合文件系统）"><a href="#4-1-2-UnionFS（联合文件系统）" class="headerlink" title="4.1.2 UnionFS（联合文件系统）"></a>4.1.2 UnionFS（联合文件系统）</h4><p>UnionFS（联合文件系统）：Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtual filesystem)。Union 文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139366360-eee5b96b-2f64-4a11-a3ae-5aa027fc7d33.png#averageHue=%23c8b77b&clientId=uc7bc2b35-0cbd-4&from=paste&height=314&id=u4910c054&originHeight=314&originWidth=526&originalType=binary&ratio=1&rotation=0&showTitle=false&size=246350&status=done&style=none&taskId=u470c301e-dbe7-4190-9854-d2e54d826f0&title=&width=526" alt="image.png"><br>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录</p>
<h4 id="4-1-3-Docker镜像加载原理"><a href="#4-1-3-Docker镜像加载原理" class="headerlink" title="4.1.3 Docker镜像加载原理"></a>4.1.3 Docker镜像加载原理</h4><p>docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。<br>bootfs(boot file system)主要包含bootloader和kernel, bootloader主要是引导加载kernel, Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是引导文件系统bootfs。这一层与我们典型的Linux&#x2F;Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。<br>rootfs (root file system) ，在bootfs之上。包含的就是典型 Linux 系统中的 &#x2F;dev, &#x2F;proc, &#x2F;bin, &#x2F;etc 等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139389739-dedef184-d920-4cb8-b046-6d74cd73a390.png#averageHue=%23a4a6a2&clientId=uc7bc2b35-0cbd-4&from=paste&height=440&id=uefc7eed4&originHeight=440&originWidth=631&originalType=binary&ratio=1&rotation=0&showTitle=false&size=288182&status=done&style=none&taskId=u935d61d5-3c6c-4472-91a7-ae66f2dd6d9&title=&width=631" alt="image.png"><br>平时我们安装进虚拟机的CentOS都是好几个G，为什么docker这里才200M？？<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139396091-72001717-33f4-4790-afbe-9d4e8198447a.png#averageHue=%23f4f0f0&clientId=uc7bc2b35-0cbd-4&from=paste&height=105&id=ua606fd7b&originHeight=105&originWidth=800&originalType=binary&ratio=1&rotation=0&showTitle=false&size=11057&status=done&style=none&taskId=u61c6b335-5ca8-4aeb-856b-291f608643a&title=&width=800" alt="image.png"><br>对于一个精简的OS，rootfs可以很小，只需要包括最基本的命令、工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供 rootfs 就行了。由此可见对于不同的linux发行版, bootfs基本是一致的, rootfs会有差别, 因此不同的发行版可以公用bootfs。</p>
<h4 id="4-1-4-为什么-Docker-镜像要采用这种分层结构呢"><a href="#4-1-4-为什么-Docker-镜像要采用这种分层结构呢" class="headerlink" title="4.1.4 为什么 Docker 镜像要采用这种分层结构呢"></a>4.1.4 为什么 Docker 镜像要采用这种分层结构呢</h4><p>镜像分层最大的一个好处就是共享资源，方便复制迁移，就是为了复用。<br>比如说有多个镜像都从相同的 base 镜像构建而来，那么 Docker Host 只需在磁盘上保存一份 base 镜像；<br>同时内存中也只需加载一份 base 镜像，就可以为所有容器服务了。而且镜像的每一层都可以被共享。</p>
<h3 id="4-2-重点理解"><a href="#4-2-重点理解" class="headerlink" title="4.2 重点理解"></a>4.2 重点理解</h3><p>Docker镜像层都是只读的，容器层是可写的。当容器启动时，一个新的可写层被加载到镜像的顶部。 这一层通常被称作“容器层”，“容器层”之下的都叫“镜像层”。<br>所有对容器的改动 - 无论添加、删除、还是修改文件都只会发生在容器层中。只有容器层是可写的，容器层下面的所有镜像层都是只读的。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139462778-98182b2f-6e3d-4e23-96ca-04107d94efe9.png#averageHue=%234ba5bd&clientId=uc7bc2b35-0cbd-4&from=paste&height=454&id=u9dd4a381&originHeight=454&originWidth=539&originalType=binary&ratio=1&rotation=0&showTitle=false&size=219715&status=done&style=none&taskId=u29e119b4-6031-457d-aa55-a0471e5afe2&title=&width=539" alt="image.png"></p>
<h3 id="4-3-Docker镜像commit操作案例"><a href="#4-3-Docker镜像commit操作案例" class="headerlink" title="4.3 Docker镜像commit操作案例"></a>4.3 Docker镜像commit操作案例</h3><p>docker commit 提交容器副本使之成为一个新的镜像<br><code>docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器ID 要创建的目标镜像名:[标签名]</code></p>
<h4 id="4-3-1-案例演示ubuntu安装vim"><a href="#4-3-1-案例演示ubuntu安装vim" class="headerlink" title="4.3.1 案例演示ubuntu安装vim"></a>4.3.1 案例演示ubuntu安装vim</h4><ol>
<li><strong>从Hub上下载ubuntu镜像到本地并成功运行</strong></li>
<li><strong>原始的默认Ubuntu镜像是不带着vim命令的</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139528237-90855992-8e34-4d7b-bfb5-ce29b0ac411f.png#averageHue=%23fdfdfd&clientId=uc7bc2b35-0cbd-4&from=paste&height=231&id=u8b0dcfbb&originHeight=231&originWidth=717&originalType=binary&ratio=1&rotation=0&showTitle=false&size=48155&status=done&style=none&taskId=u9519bef2-6149-42df-8a91-b2c1f26902f&title=&width=717" alt="image.png"></p>
<ol start="3">
<li><strong>外网连通的情况下，安装vim</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139546512-e54ea2c6-cf8e-4782-915a-b0c59fb0c5dc.png#averageHue=%232e3444&clientId=uc7bc2b35-0cbd-4&from=paste&height=97&id=u89f9e8e3&originHeight=97&originWidth=234&originalType=binary&ratio=1&rotation=0&showTitle=false&size=6701&status=done&style=none&taskId=uab385052-4fd5-4db7-acb7-592e8dde5f2&title=&width=234" alt="image.png"><br>docker容器内执行上述两条命令：<br><code>apt-get update</code><br><code>apt-get -y install vim</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139552106-4c75c757-2789-4b36-9162-d435e5278456.png#averageHue=%23fefafa&clientId=uc7bc2b35-0cbd-4&from=paste&height=359&id=u04d84326&originHeight=359&originWidth=1049&originalType=binary&ratio=1&rotation=0&showTitle=false&size=109988&status=done&style=none&taskId=u3319c99a-937f-46e8-b174-8c1a0800abd&title=&width=1049" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139557574-59af7f26-86c4-4af9-bba7-650897d6ff82.png#averageHue=%23fefcfc&clientId=uc7bc2b35-0cbd-4&from=paste&height=259&id=u67524e2e&originHeight=259&originWidth=1136&originalType=binary&ratio=1&rotation=0&showTitle=false&size=58336&status=done&style=none&taskId=ucdc32189-fd16-42ba-a9bb-e42b5faae7a&title=&width=1136" alt="image.png"></p>
<ol start="4">
<li><strong>安装完成后，commit我们自己的新镜像</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139596868-4312899d-c9dd-4a45-9b34-8a075d61116c.png#averageHue=%23fefcfc&clientId=uc7bc2b35-0cbd-4&from=paste&height=259&id=uf6d8b048&originHeight=259&originWidth=1136&originalType=binary&ratio=1&rotation=0&showTitle=false&size=58249&status=done&style=none&taskId=uef2a16f7-9067-4918-88ae-f507e13a011&title=&width=1136" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139602000-6bb1bb7f-a2f8-4bad-8d03-ff1f147da555.png#averageHue=%23fef9f9&clientId=uc7bc2b35-0cbd-4&from=paste&height=274&id=uec8656e1&originHeight=274&originWidth=1197&originalType=binary&ratio=1&rotation=0&showTitle=false&size=75309&status=done&style=none&taskId=u8d43390c-86e5-4c75-b1a3-62bdf5b7b9b&title=&width=1197" alt="image.png"></p>
<ol start="5">
<li><strong>启动我们的新镜像并和原来的对比</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139612305-4d9e9f72-1e44-4988-8ef3-255090cd1b82.png#averageHue=%23fdf9f9&clientId=uc7bc2b35-0cbd-4&from=paste&height=274&id=ubd738772&originHeight=274&originWidth=1197&originalType=binary&ratio=1&rotation=0&showTitle=false&size=75320&status=done&style=none&taskId=u9cb0e276-a453-4c71-82a9-b23a42b02f9&title=&width=1197" alt="image.png"></p>
<pre><code>  1. 官网是默认下载的Ubuntu没有vim命令
  2. 我们自己commit构建的镜像，新增加了vim功能，可以成功使用。
</code></pre>
<h4 id="4-3-2-小总结"><a href="#4-3-2-小总结" class="headerlink" title="4.3.2 小总结"></a>4.3.2 小总结</h4><p>Docker中的镜像分层，支持通过扩展现有镜像，创建新的镜像。类似Java继承于一个Base基础类，自己再按需扩展。<br>新镜像是从 base 镜像一层一层叠加生成的。每安装一个软件，就在现有镜像的基础上增加一层<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139701434-5322591f-b716-4232-8f3c-9420ba706072.png#averageHue=%23a6c5c3&clientId=uc7bc2b35-0cbd-4&from=paste&height=273&id=u61367ba6&originHeight=273&originWidth=836&originalType=binary&ratio=1&rotation=0&showTitle=false&size=195447&status=done&style=none&taskId=u117af23f-bc66-4141-992d-a76affa8636&title=&width=836" alt="image.png"></p>
<h1 id="5-本地镜像发布到阿里云"><a href="#5-本地镜像发布到阿里云" class="headerlink" title="5 本地镜像发布到阿里云"></a>5 本地镜像发布到阿里云</h1><h2 id="5-1-本地镜像发布到阿里云流程"><a href="#5-1-本地镜像发布到阿里云流程" class="headerlink" title="5.1 本地镜像发布到阿里云流程"></a>5.1 本地镜像发布到阿里云流程</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139786698-1f881901-f53d-482d-8198-5c71a779db6f.png#averageHue=%23f5f5f5&clientId=uc7bc2b35-0cbd-4&from=paste&height=571&id=u3b784860&originHeight=571&originWidth=642&originalType=binary&ratio=1&rotation=0&showTitle=false&size=105093&status=done&style=none&taskId=u6a546cfb-34a7-447b-a459-7e52bf1c344&title=&width=642" alt="image.png"></p>
<h2 id="5-2-镜像的生成方法"><a href="#5-2-镜像的生成方法" class="headerlink" title="5.2 镜像的生成方法"></a>5.2 镜像的生成方法</h2><p>基于当前容器创建一个新的镜像，新功能增强 <code>docker commit [OPTIONS] 容器ID [REPOSITORY[:TAG]]</code><br>:::info<br>OPTIONS说明：<br>-a :提交的镜像作者；<br>-m :提交时的说明文字；<br>:::<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139828870-7f14de5e-85a2-4409-b30d-1d833b6e014a.png#averageHue=%23f1eded&clientId=uc7bc2b35-0cbd-4&from=paste&height=369&id=uf085d4e9&originHeight=369&originWidth=918&originalType=binary&ratio=1&rotation=0&showTitle=false&size=56417&status=done&style=none&taskId=ueeba4ba8-a708-45ed-b836-ef196fe452d&title=&width=918" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139835046-ce1ff5bb-96dc-46a8-92ac-9cc522f730ab.png#averageHue=%23fef5f5&clientId=uc7bc2b35-0cbd-4&from=paste&height=402&id=ufeae1849&originHeight=402&originWidth=819&originalType=binary&ratio=1&rotation=0&showTitle=false&size=81789&status=done&style=none&taskId=u5bcb61d1-ebb2-440f-a9b8-74a455a6d9d&title=&width=819" alt="image.png"></p>
<h2 id="5-3-将本地镜像推送到阿里云"><a href="#5-3-将本地镜像推送到阿里云" class="headerlink" title="5.3 将本地镜像推送到阿里云"></a>5.3 将本地镜像推送到阿里云</h2><p>本地镜像素材原型<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139862888-96cc93ff-c7a6-4f73-9268-c9a9fd06dad3.png#averageHue=%23eee1e0&clientId=uc7bc2b35-0cbd-4&from=paste&height=59&id=ucfe88ec4&originHeight=59&originWidth=863&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9921&status=done&style=none&taskId=u4d437ca3-e73d-4deb-985d-ced710feb67&title=&width=863" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139867564-59ac7072-d068-4d74-b012-de24e64f65b0.png#averageHue=%23fcf7f7&clientId=uc7bc2b35-0cbd-4&from=paste&height=72&id=ua81c7d0c&originHeight=72&originWidth=794&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15108&status=done&style=none&taskId=u775dbc94-e8f1-4d38-92b3-0d22a71b9d4&title=&width=794" alt="image.png"><br>阿里云开发者平台<br><a target="_blank" rel="noopener" href="https://promotion.aliyun.com/ntms/act/kubernetes.html">https://promotion.aliyun.com/ntms/act/kubernetes.html</a><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139877321-2fee875d-2343-460f-93ba-5eadd35c479b.png#averageHue=%23b3ccc5&clientId=uc7bc2b35-0cbd-4&from=paste&height=597&id=u1eca9d66&originHeight=597&originWidth=1351&originalType=binary&ratio=1&rotation=0&showTitle=false&size=286725&status=done&style=none&taskId=uc5335389-8ce6-47c1-b00a-f975f9c4c25&title=&width=1351" alt="image.png"></p>
<h3 id="5-3-1-创建仓库镜像"><a href="#5-3-1-创建仓库镜像" class="headerlink" title="5.3.1 创建仓库镜像"></a>5.3.1 创建仓库镜像</h3><ol>
<li><strong>选择控制台，进入容器镜像服务</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139928853-ccc16d88-bb05-4f73-82f3-429a883e6754.png#averageHue=%23fbf7f6&clientId=uc7bc2b35-0cbd-4&from=paste&height=605&id=udf761ace&originHeight=605&originWidth=789&originalType=binary&ratio=1&rotation=0&showTitle=false&size=69535&status=done&style=none&taskId=ue0a313b2-42e8-4667-b25d-6d3e2e51f5e&title=&width=789" alt="image.png"></p>
<ol start="2">
<li><strong>选择个人实例</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139936677-14362c3e-3c89-4af3-8ebf-233b303e59ce.png#averageHue=%23faf6f3&clientId=uc7bc2b35-0cbd-4&from=paste&height=432&id=u842ac95e&originHeight=432&originWidth=1002&originalType=binary&ratio=1&rotation=0&showTitle=false&size=48258&status=done&style=none&taskId=u9882bf43-4cd2-437e-a89f-e14e68bac44&title=&width=1002" alt="image.png"></p>
<ol start="3">
<li><strong>命名空间</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139942874-f2e3db26-3f56-46d1-b353-da6c80b4064e.png#averageHue=%23fcfbfa&clientId=uc7bc2b35-0cbd-4&from=paste&height=513&id=u9ada1370&originHeight=513&originWidth=1001&originalType=binary&ratio=1&rotation=0&showTitle=false&size=40866&status=done&style=none&taskId=uf9680671-be40-43ad-a00d-7c29b3d5229&title=&width=1001" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139948785-659bd67e-b21f-46ef-9b9c-4cff763f0c30.png#averageHue=%23adacab&clientId=uc7bc2b35-0cbd-4&from=paste&height=531&id=u50bb16e4&originHeight=531&originWidth=990&originalType=binary&ratio=1&rotation=0&showTitle=false&size=44672&status=done&style=none&taskId=u793b703e-2418-4a96-81a8-15628c29d7f&title=&width=990" alt="image.png"></p>
<ol start="4">
<li><strong>仓库名称</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139954429-530f3efa-c1cf-41ab-8ee3-4d0ed47a5423.png#averageHue=%23fcfaf9&clientId=uc7bc2b35-0cbd-4&from=paste&height=442&id=u91f22b4d&originHeight=442&originWidth=886&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28680&status=done&style=none&taskId=u386a15a5-1dfb-46a8-a8f8-ab3c321de51&title=&width=886" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139962035-85aaed76-b131-4997-8ba6-aeafc9e45a45.png#averageHue=%23d9d6d6&clientId=uc7bc2b35-0cbd-4&from=paste&height=593&id=u53a9b5df&originHeight=593&originWidth=1088&originalType=binary&ratio=1&rotation=0&showTitle=false&size=53441&status=done&style=none&taskId=u82322608-7780-4b99-adab-bd6b131f8ac&title=&width=1088" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139971022-400de815-a008-4fbd-8ac3-16d2337d68a3.png#averageHue=%23c3c1c1&clientId=uc7bc2b35-0cbd-4&from=paste&height=513&id=u23abe084&originHeight=513&originWidth=1086&originalType=binary&ratio=1&rotation=0&showTitle=false&size=42840&status=done&style=none&taskId=u7a607c6b-0d41-498e-95ae-f24e96544a0&title=&width=1086" alt="image.png"></p>
<ol start="5">
<li><strong>进入管理界面获得脚本</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658139979398-d997e648-e878-44bf-97a9-99a9b4cc182b.png#averageHue=%23fcfaf9&clientId=uc7bc2b35-0cbd-4&from=paste&height=390&id=u7cd885f8&originHeight=390&originWidth=1230&originalType=binary&ratio=1&rotation=0&showTitle=false&size=38220&status=done&style=none&taskId=u6ee6ab7b-37e6-4117-ad97-0f04e6b01f5&title=&width=1230" alt="image.png"></p>
<h3 id="5-3-2-将镜像推送到阿里云"><a href="#5-3-2-将镜像推送到阿里云" class="headerlink" title="5.3.2 将镜像推送到阿里云"></a>5.3.2 将镜像推送到阿里云</h3><ol>
<li><strong>管理界面脚本</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658140037335-a8e58945-9160-4db5-82d7-51bdce65a98f.png#averageHue=%23ddc1a9&clientId=uc7bc2b35-0cbd-4&from=paste&height=503&id=ub425a83c&originHeight=503&originWidth=761&originalType=binary&ratio=1&rotation=0&showTitle=false&size=123257&status=done&style=none&taskId=u19586877-9b92-4d1a-ab1b-a29bb0c4a12&title=&width=761" alt="image.png"></p>
<ol start="2">
<li><strong>脚本实例</strong></li>
</ol>
<p><code>docker login --username=zzyybuy registry.cn-hangzhou.aliyuncs.com</code><br><code>docker tag cea1bb40441c registry.cn-hangzhou.aliyuncs.com/atguiguwh/myubuntu:1.1</code><br><code>docker push registry.cn-hangzhou.aliyuncs.com/atguiguwh/myubuntu:1.1</code><br>上面命令是阳哥自己本地的，你自己酌情处理，不要粘贴我的。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658140061637-73ca4162-693e-4e3a-8431-b7b3f969d791.png#averageHue=%23fef7f7&clientId=uc7bc2b35-0cbd-4&from=paste&height=492&id=u3af2ee9f&originHeight=492&originWidth=1085&originalType=binary&ratio=1&rotation=0&showTitle=false&size=117028&status=done&style=none&taskId=uef1a803d-beb5-4612-b893-ffcc0f3b88d&title=&width=1085" alt="image.png"></p>
<h2 id="5-4-将阿里云上的镜像下载到本地"><a href="#5-4-将阿里云上的镜像下载到本地" class="headerlink" title="5.4 将阿里云上的镜像下载到本地"></a>5.4 将阿里云上的镜像下载到本地</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658140107483-05a4996e-cc38-4cc9-8ede-6b137c76d182.png#averageHue=%23fefbfb&clientId=uc7bc2b35-0cbd-4&from=paste&height=481&id=ub51a4007&originHeight=481&originWidth=1153&originalType=binary&ratio=1&rotation=0&showTitle=false&size=121303&status=done&style=none&taskId=uafb34e57-9dea-4505-a786-0bf121f1f48&title=&width=1153" alt="image.png"><br><code>docker pull registry.cn-hangzhou.aliyuncs.com/atguiguwh/myubuntu:1.1</code></p>
<h1 id="6-本地镜像发布到私有库"><a href="#6-本地镜像发布到私有库" class="headerlink" title="6 本地镜像发布到私有库"></a>6 本地镜像发布到私有库</h1><p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658140528137-0139f39f-85e8-4b9c-8b90-176cf342f638.png#averageHue=%23f6f6f6&clientId=uc7bc2b35-0cbd-4&from=paste&height=482&id=uc16bf9e5&originHeight=482&originWidth=541&originalType=binary&ratio=1&rotation=0&showTitle=false&size=74573&status=done&style=none&taskId=ubdcc20a8-8e48-4a97-aa79-c6b3b04ce65&title=&width=541" alt="image.png"></p>
<h2 id="6-1-是什么"><a href="#6-1-是什么" class="headerlink" title="6.1 是什么"></a>6.1 是什么</h2><p>1 官方Docker Hub地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a>，中国大陆访问太慢了且准备被阿里云取代的趋势，不太主流。<br>2 Dockerhub、阿里云这样的公共镜像仓库可能不太方便，涉及机密的公司不可能提供镜像给公网，所以需要创建一个本地私人仓库供给团队使用，基于公司内部项目构建镜像。<br>Docker Registry是官方提供的工具，可以用于构建私有镜像仓库</p>
<h2 id="6-2-将本地镜像推送到私有库"><a href="#6-2-将本地镜像推送到私有库" class="headerlink" title="6.2 将本地镜像推送到私有库"></a>6.2 将本地镜像推送到私有库</h2><h2 id="Nexus私有仓库-详细步骤请看xmind笔记"><a href="#Nexus私有仓库-详细步骤请看xmind笔记" class="headerlink" title="Nexus私有仓库 详细步骤请看xmind笔记"></a>Nexus私有仓库 详细步骤请看xmind笔记</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">mkdir</span> <span class="string">nexus</span></span><br><span class="line"><span class="string">chmod</span> <span class="number">777</span> <span class="string">-R</span> <span class="string">nexus/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 nexus 容器</span></span><br><span class="line"><span class="string">docker</span> <span class="string">run</span> <span class="string">-d</span> <span class="string">--restart=always</span> <span class="string">-p</span> <span class="number">8868</span><span class="string">:8081</span> <span class="string">-p</span> <span class="number">5000</span><span class="string">:5000</span> <span class="string">-p</span> <span class="number">5001</span><span class="string">:5001</span> <span class="string">--name</span> <span class="string">nexus</span> <span class="string">-v</span> <span class="string">/opt/docker/nexus:/nexus-data</span> <span class="string">sonatype/nexus3</span></span><br></pre></td></tr></table></figure>


<h1 id="7-Docker容器数据卷"><a href="#7-Docker容器数据卷" class="headerlink" title="7 Docker容器数据卷"></a>7 Docker容器数据卷</h1><h2 id="7-1-坑：容器卷记得加入"><a href="#7-1-坑：容器卷记得加入" class="headerlink" title="7.1 坑：容器卷记得加入"></a>7.1 坑：容器卷记得加入</h2><p><code>--privileged=true</code><br>Docker挂载主机目录访问如果出现cannot open directory .: Permission denied<br><strong>解决办法：在挂载目录后多加一个–privileged&#x3D;true参数即可</strong><br>如果是CentOS7安全模块会比之前系统版本加强，不安全的会先禁止，所以目录挂载的情况被默认为不安全的行为，在SELinux里面挂载目录被禁止掉了，如果要开启，我们一般使用–privileged&#x3D;true命令，扩大容器的权限解决挂载目录没有权限的问题，也即使用该参数，container内的root拥有真正的root权限，否则，container内的root只是外部的一个普通用户权限。</p>
<h2 id="7-2-回顾下上一讲的知识点，参数V"><a href="#7-2-回顾下上一讲的知识点，参数V" class="headerlink" title="7.2 回顾下上一讲的知识点，参数V"></a>7.2 回顾下上一讲的知识点，参数V</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658193898005-66ac7a6e-7f2f-4f7b-899d-5114a1215fa0.png#averageHue=%23fdf7f6&clientId=uc73566a5-2b6f-4&from=paste&height=335&id=uf93fc416&originHeight=335&originWidth=1254&originalType=binary&ratio=1&rotation=0&showTitle=false&size=57602&status=done&style=none&taskId=u31c10274-10f1-4456-834d-11b5fd4c8c2&title=&width=1254" alt="image.png"></p>
<h2 id="7-3-是什么"><a href="#7-3-是什么" class="headerlink" title="7.3 是什么"></a>7.3 是什么</h2><p>卷就是目录或文件，存在于一个或多个容器中，由docker挂载到容器，但不属于联合文件系统，因此能够绕过Union File System提供一些用于持续存储或共享数据的特性：卷的设计目的就是数据的持久化，完全独立于容器的生存周期，因此Docker不会在容器删除时删除其挂载的数据卷。<br><strong>一句话：有点类似我们Redis里面的rdb和aof文件。</strong><br>将docker容器内的数据保存进宿主机的磁盘中，运行一个带有容器卷存储功能的容器实例。<br><code> docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录      镜像名</code></p>
<h2 id="7-4-能干嘛"><a href="#7-4-能干嘛" class="headerlink" title="7.4 能干嘛"></a>7.4 能干嘛</h2><p>将运用与运行的环境打包镜像，run后形成容器实例运行 ，但是我们对数据的要求希望是持久化的。<br>Docker容器产生的数据，如果不备份，那么当容器实例删除后，容器内的数据自然也就没有了。为了能保存数据在docker中我们使用卷。<br>特点：</p>
<ol>
<li><strong>数据卷可在容器之间共享或重用数据</strong></li>
<li><strong>卷中的更改可以直接实时生效，爽</strong></li>
<li><strong>数据卷中的更改不会包含在镜像的更新中</strong></li>
<li><strong>数据卷的生命周期一直持续到没有容器使用它为止</strong></li>
</ol>
<h2 id="7-5-数据卷案例"><a href="#7-5-数据卷案例" class="headerlink" title="7.5 数据卷案例"></a>7.5 数据卷案例</h2><h3 id="7-5-1-宿主vs容器之间映射添加容器卷"><a href="#7-5-1-宿主vs容器之间映射添加容器卷" class="headerlink" title="7.5.1 宿主vs容器之间映射添加容器卷"></a>7.5.1 宿主vs容器之间映射添加容器卷</h3><ol>
<li><code>直接命令添加</code></li>
</ol>
<p><code>docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录 镜像名</code><br>公式：<code>docker run -it -v /宿主机目录:/容器内目录 ubuntu /bin/bash</code><br><code>docker run -it --name myu3 --privileged=true -v /tmp/myHostData:/tmp/myDockerData ubuntu /bin/bash</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658226408944-61a9764d-b3db-42f6-b8e6-10ed888287d9.png#averageHue=%23f9f2f2&clientId=u56dc0970-6681-4&from=paste&height=398&id=ucc12a350&originHeight=498&originWidth=832&originalType=binary&ratio=1&rotation=0&showTitle=false&size=56148&status=done&style=none&taskId=u6dd32c7f-6d71-42cd-b0a0-e4c9835c52c&title=&width=665.6" alt="image.png"></p>
<ol start="2">
<li><strong>查看数据卷是否挂载成功</strong></li>
</ol>
<p><code>docker inspect 容器ID</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658226437704-b3a2cbb1-9110-4a67-b6d8-fcf33c3fae29.png#averageHue=%23fef9f9&clientId=u56dc0970-6681-4&from=paste&height=173&id=u4085ebd3&originHeight=216&originWidth=580&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18077&status=done&style=none&taskId=ub7436ccd-8c74-4014-975d-5e2b69e646c&title=&width=464" alt="image.png"></p>
<ol start="3">
<li><strong>容器和宿主机之间数据共享</strong><ol>
<li>docker修改，主机同步获得 。</li>
<li>主机修改，docker同步获得。</li>
<li>docker容器stop，主机修改，docker容器重启看数据是否同步。</li>
</ol>
</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658226473979-b13500a4-0605-49d3-aa07-7e405342dd92.png#averageHue=%23fbf7f6&clientId=u56dc0970-6681-4&from=paste&height=353&id=ufbc07740&originHeight=441&originWidth=1358&originalType=binary&ratio=1&rotation=0&showTitle=false&size=103394&status=done&style=none&taskId=uc96d88ed-3384-4ee0-b3f5-8f1642c36f8&title=&width=1086.4" alt="image.png"></p>
<h3 id="7-5-2-读写规则映射添加说明"><a href="#7-5-2-读写规则映射添加说明" class="headerlink" title="7.5.2 读写规则映射添加说明"></a>7.5.2 读写规则映射添加说明</h3><p>读写(默认)<br><code>docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录:rw 镜像名</code><br>默认同上案例，默认就是rw<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658226514729-c2112eaf-6ec8-47ee-94a0-35f8ea7c9beb.png#averageHue=%23fef7f7&clientId=u56dc0970-6681-4&from=paste&height=140&id=u5d443fb8&originHeight=175&originWidth=968&originalType=binary&ratio=1&rotation=0&showTitle=false&size=35575&status=done&style=none&taskId=u2be83f14-bb6a-4908-88b2-969d12c924a&title=&width=774.4" alt="image.png"><br>rw &#x3D; read + write<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658226520150-41d79186-a2ef-460f-80b6-dcb0bbee1ecb.png#averageHue=%23fefafa&clientId=u56dc0970-6681-4&from=paste&height=180&id=u9f620c96&originHeight=225&originWidth=464&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14371&status=done&style=none&taskId=ub1e79ae3-37cb-4847-a973-e253299f432&title=&width=371.2" alt="image.png"><br>只读<br>容器实例内部被限制，只能读取不能写<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658226536605-315fd061-8879-4685-a4cd-345ff3fcd1d7.png#averageHue=%23fef8f8&clientId=u56dc0970-6681-4&from=paste&height=208&id=u5d9cdf2f&originHeight=260&originWidth=940&originalType=binary&ratio=1&rotation=0&showTitle=false&size=49462&status=done&style=none&taskId=u79008790-cb37-410f-bfc9-eb8d3e42e47&title=&width=752" alt="image.png"><br>&#x2F;容器目录:ro 镜像名               就能完成功能，此时容器自己只能读取不能写<br>ro &#x3D; read only<br>此时如果宿主机写入内容，可以同步给容器内，容器可以读取到。<br><code>docker run -it --privileged=true -v /宿主机绝对路径目录:/容器内目录:ro 镜像名</code></p>
<h3 id="7-5-3-卷的继承和共享"><a href="#7-5-3-卷的继承和共享" class="headerlink" title="7.5.3 卷的继承和共享"></a>7.5.3 卷的继承和共享</h3><p>容器1完成和宿主机的映射<br><code>docker run -it  --privileged=true -v /mydocker/u:/tmp --name u1 ubuntu</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658226567377-ed27036f-cba3-4e16-9d6a-b18e249e0464.png#averageHue=%23fef4f4&clientId=u56dc0970-6681-4&from=paste&height=145&id=ud9baaabc&originHeight=181&originWidth=948&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34929&status=done&style=none&taskId=u2872324a-7312-4436-b74b-28e51572d0e&title=&width=758.4" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658226571771-a1484811-0dae-4ddb-bf4b-e3c69b001269.png#averageHue=%23fefbfb&clientId=u56dc0970-6681-4&from=paste&height=106&id=u09af9264&originHeight=133&originWidth=691&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17836&status=done&style=none&taskId=u3fe583ea-4cb5-40d4-a0f8-7360d9338dd&title=&width=552.8" alt="image.png"><br>容器2继承容器1的卷规则<br><code>docker run -it  --privileged=true --volumes-from 父类  --name u2 ubuntu</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658226594280-b1d73980-163b-4bbb-bc46-823b22e432dd.png#averageHue=%23fefbfb&clientId=u56dc0970-6681-4&from=paste&height=206&id=u7a0a1b1d&originHeight=257&originWidth=897&originalType=binary&ratio=1&rotation=0&showTitle=false&size=52771&status=done&style=none&taskId=ub5977afc-368d-49e2-bb6f-4fdf64233b2&title=&width=717.6" alt="image.png"></p>
<h1 id="8-Docker常规安装简介"><a href="#8-Docker常规安装简介" class="headerlink" title="8 Docker常规安装简介"></a>8 Docker常规安装简介</h1><h2 id="8-1-总体步骤"><a href="#8-1-总体步骤" class="headerlink" title="8.1 总体步骤"></a>8.1 总体步骤</h2><ol>
<li>搜索镜像</li>
<li>拉取镜像</li>
<li>查看镜像</li>
<li>启动镜像 - 服务端口映射</li>
<li>停止容器</li>
<li>移除容器</li>
</ol>
<h2 id="8-2-安装tomcat"><a href="#8-2-安装tomcat" class="headerlink" title="8.2 安装tomcat"></a>8.2 安装tomcat</h2><ol>
<li><strong>docker hub上面查找tomcat镜像</strong></li>
</ol>
<p><code>docker search tomcat</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658227019564-3256fed5-8d29-4b9b-b63c-f9db6688647f.png#averageHue=%23f1f1f1&clientId=u56dc0970-6681-4&from=paste&height=410&id=u554bbd0b&originHeight=513&originWidth=1024&originalType=binary&ratio=1&rotation=0&showTitle=false&size=82047&status=done&style=none&taskId=ud6078fbc-4aef-4666-8ad5-7f3a8537af9&title=&width=819.2" alt="image.png"></p>
<ol start="2">
<li><strong>从docker hub上拉取tomcat镜像到本地</strong></li>
</ol>
<p><code>docker pull tomcat</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658227032736-fd32aed9-dbe6-4fdf-8323-37a9f764528a.png#averageHue=%23f5f4f4&clientId=u56dc0970-6681-4&from=paste&height=391&id=u838d475c&originHeight=489&originWidth=852&originalType=binary&ratio=1&rotation=0&showTitle=false&size=61294&status=done&style=none&taskId=u70291ca0-ea2b-4632-8376-90a0ccf0b7e&title=&width=681.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658227037231-8c821604-210e-432f-a311-552c51918845.png#averageHue=%23f2e6e6&clientId=u56dc0970-6681-4&from=paste&height=110&id=u43febf4e&originHeight=137&originWidth=806&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16721&status=done&style=none&taskId=u70bc463e-c5ea-459f-971b-23541fe7c6f&title=&width=644.8" alt="image.png"></p>
<ol start="3">
<li><strong>docker images查看是否有拉取到的tomcat</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658227047824-ae101631-a620-4703-9dac-8af6d9b80fdc.png#averageHue=%23fefefe&clientId=u56dc0970-6681-4&from=paste&height=78&id=u7377cedd&originHeight=98&originWidth=612&originalType=binary&ratio=1&rotation=0&showTitle=false&size=17367&status=done&style=none&taskId=u7200d213-1933-4a92-963a-320e1d7912e&title=&width=489.6" alt="image.png"></p>
<ol start="4">
<li><strong>使用tomcat镜像创建容器实例(也叫运行镜像)</strong></li>
</ol>
<p><code>docker run -it -p 8080:8080 tomcat</code><br>:::info<br>-p 小写，主机端口:docker容器端口<br>-P 大写，随机分配端口<br>-i 交互<br>-t 终端<br>-d 后台<br>:::<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658227076652-dccf1356-5133-4dfd-ad51-31bdc8d905d5.png#averageHue=%23e5e1e0&clientId=u56dc0970-6681-4&from=paste&height=243&id=ub6ded449&originHeight=304&originWidth=1159&originalType=binary&ratio=1&rotation=0&showTitle=false&size=40565&status=done&style=none&taskId=ua29b87b2-ae98-48ed-90f4-22506ee724d&title=&width=927.2" alt="image.png"></p>
<ol start="5">
<li><strong>访问猫首页</strong></li>
</ol>
<p>问题<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658227151748-3f6e8cf0-c183-4a32-aec3-c17011ce7929.png#averageHue=%23fbfaf9&clientId=u56dc0970-6681-4&from=paste&height=226&id=ud21ac78b&originHeight=282&originWidth=811&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23924&status=done&style=none&taskId=u6bafa167-4b3b-473f-a727-9ff5638fe9d&title=&width=648.8" alt="image.png"><br>解决</p>
<pre><code>  1. 可能没有映射端口或者没有关闭防火墙
  2. 把webapps.dist目录换成webapps
</code></pre>
<p>先成功启动tomcat<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658227198315-f76f4e96-a574-4027-ab56-e8ec70855676.png#averageHue=%23fef7f7&clientId=u56dc0970-6681-4&from=paste&height=303&id=B3mU7&originHeight=379&originWidth=1315&originalType=binary&ratio=1&rotation=0&showTitle=false&size=97694&status=done&style=none&taskId=u144695de-151d-4082-810d-facfdc2af05&title=&width=1052" alt="image.png"><br>查看webapps 文件夹查看为空<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658227241415-7b7a562e-b601-45e1-982f-5cdaf482e1f9.png#averageHue=%23fef9f9&clientId=u56dc0970-6681-4&from=paste&height=386&id=u5fa9155e&originHeight=483&originWidth=772&originalType=binary&ratio=1&rotation=0&showTitle=false&size=121057&status=done&style=none&taskId=u0a60655d-c042-40c4-be7f-4a4dbcd01e3&title=&width=617.6" alt="image.png"></p>
<ol start="6">
<li><strong>免修改版说明</strong></li>
</ol>
<p><code>docker pull billygoo/tomcat8-jdk8</code><br><code>docker run -d -p 8080:8080 --name mytomcat8 billygoo/tomcat8-jdk8</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658227293652-4c38aded-e9e1-48bb-a40f-7642928172f4.png#averageHue=%23fefcfc&clientId=u56dc0970-6681-4&from=paste&height=298&id=u6ebfef4e&originHeight=373&originWidth=777&originalType=binary&ratio=1&rotation=0&showTitle=false&size=54742&status=done&style=none&taskId=u9016eb8a-55b3-43f7-8e77-303f743cd69&title=&width=621.6" alt="image.png"></p>
<h2 id="8-3-安装mysql"><a href="#8-3-安装mysql" class="headerlink" title="8.3 安装mysql"></a>8.3 安装mysql</h2><h3 id="8-3-1-docker-hub上面查找mysql镜像"><a href="#8-3-1-docker-hub上面查找mysql镜像" class="headerlink" title="8.3.1 docker hub上面查找mysql镜像"></a>8.3.1 docker hub上面查找mysql镜像</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658385582810-fcaff7bf-61c8-41b5-bf2f-ae0cf7a29e84.png#averageHue=%23f1eeee&clientId=uc440a240-4b2c-4&from=paste&height=310&id=u32bddd71&originHeight=310&originWidth=1243&originalType=binary&ratio=1&rotation=0&showTitle=false&size=71747&status=done&style=none&taskId=uac260379-592a-4dda-a7ce-d14fdd69be2&title=&width=1243" alt="image.png"></p>
<h3 id="8-3-2-从docker-hub上-阿里云加速器-拉取mysql镜像到本地标签为5-7"><a href="#8-3-2-从docker-hub上-阿里云加速器-拉取mysql镜像到本地标签为5-7" class="headerlink" title="8.3.2 从docker hub上(阿里云加速器)拉取mysql镜像到本地标签为5.7"></a>8.3.2 从docker hub上(阿里云加速器)拉取mysql镜像到本地标签为5.7</h3><p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658385588787-239d33e3-87ef-465a-9513-841f703dd972.png#averageHue=%23fefafa&clientId=uc440a240-4b2c-4&from=paste&height=395&id=ubc7fb198&originHeight=395&originWidth=895&originalType=binary&ratio=1&rotation=0&showTitle=false&size=84229&status=done&style=none&taskId=u9a833797-deb3-4684-9ba7-90e4b2abe9b&title=&width=895" alt="image.png"></p>
<h3 id="8-3-3-使用mysql5-7镜像创建容器-也叫运行镜像"><a href="#8-3-3-使用mysql5-7镜像创建容器-也叫运行镜像" class="headerlink" title="8.3.3 使用mysql5.7镜像创建容器(也叫运行镜像)"></a>8.3.3 使用mysql5.7镜像创建容器(也叫运行镜像)</h3><h4 id="8-3-3-1-命令出处，哪里来的？"><a href="#8-3-3-1-命令出处，哪里来的？" class="headerlink" title="8.3.3.1 命令出处，哪里来的？"></a>8.3.3.1 命令出处，哪里来的？</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658385610694-1b65bab9-3a5a-4cb6-a995-d715004a0c00.png#averageHue=%23eccea7&clientId=uc440a240-4b2c-4&from=paste&height=319&id=u55a29fbc&originHeight=319&originWidth=1249&originalType=binary&ratio=1&rotation=0&showTitle=false&size=35793&status=done&style=none&taskId=u3930e801-323a-4765-a27b-ece969b36b4&title=&width=1249" alt="image.png"></p>
<h4 id="8-3-3-2-简单版"><a href="#8-3-3-2-简单版" class="headerlink" title="8.3.3.2 简单版"></a>8.3.3.2 简单版</h4><p>使用mysql镜像<br><code>docker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</code><br><code>docker ps</code><br><code>docker exec -it 容器ID /bin/bash</code><br><code>mysql -uroot -p</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658385723966-fa2bc241-6f24-4faf-96a2-3098a16d1706.png#averageHue=%23fefafa&clientId=uc440a240-4b2c-4&from=paste&height=446&id=uc297b376&originHeight=446&originWidth=1350&originalType=binary&ratio=1&rotation=0&showTitle=false&size=99606&status=done&style=none&taskId=ufed2d980-226a-400a-a121-76f9b809104&title=&width=1350" alt="image.png"><br>建库建表插入数据<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658385758209-655c9da4-e2cc-481b-b714-7c62d93d7d0a.png#averageHue=%23fdf5f5&clientId=uc440a240-4b2c-4&from=paste&height=552&id=u375c9497&originHeight=552&originWidth=642&originalType=binary&ratio=1&rotation=0&showTitle=false&size=49380&status=done&style=none&taskId=u180d94a9-9947-429b-834c-0a664bdef5f&title=&width=642" alt="image.png"><br>外部Win10也来连接运行在dokcer上的mysql容器实例服务<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658385770994-f0843127-92ef-4299-94b6-3b641109d2cc.png#averageHue=%23ebe6e5&clientId=uc440a240-4b2c-4&from=paste&height=460&id=u26364316&originHeight=460&originWidth=625&originalType=binary&ratio=1&rotation=0&showTitle=false&size=70516&status=done&style=none&taskId=u7899d130-79af-4c69-825b-076de025f24&title=&width=625" alt="image.png"><br>问题<br>插入中文数据试试<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658385783102-bdbbdfe5-30f1-493c-bdc3-79c35c2bf8f5.png#averageHue=%23f9f4f1&clientId=uc440a240-4b2c-4&from=paste&height=397&id=u36a890b0&originHeight=397&originWidth=971&originalType=binary&ratio=1&rotation=0&showTitle=false&size=34047&status=done&style=none&taskId=u805306da-1dde-46cf-8aee-e9096a7a59b&title=&width=971" alt="image.png"><br>为什么报错?<br>docker上默认字符集编码隐患,docker里面的mysql容器实例查看，内容如下：<br><code>SHOW VARIABLES LIKE &#39;character%&#39;</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658385796114-e5691a9b-d302-4058-9467-90bd86a26944.png#averageHue=%23fefefe&clientId=uc440a240-4b2c-4&from=paste&height=349&id=ue9f8a73d&originHeight=349&originWidth=643&originalType=binary&ratio=1&rotation=0&showTitle=false&size=38415&status=done&style=none&taskId=ub9c5ae2e-483e-4d84-8638-2375789cb9c&title=&width=643" alt="image.png"><br>删除容器后，里面的mysql数据怎么办？</p>
<h4 id="8-3-3-3-实战版"><a href="#8-3-3-3-实战版" class="headerlink" title="8.3.3.3 实战版"></a>8.3.3.3 实战版</h4><p>新建mysql容器实例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3306:3306 </span><br><span class="line">--privileged=true </span><br><span class="line">-v /zzyyuse/mysql/log:/var/log/mysql </span><br><span class="line">-v /zzyyuse/mysql/data:/var/lib/mysql </span><br><span class="line">-v /zzyyuse/mysql/conf:/etc/mysql/conf.d </span><br><span class="line">-eMYSQL_ROOT_PASSWORD=123456  </span><br><span class="line">--name mysql mysql:5.7</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658385958447-19a567d5-61af-409b-a8de-dcfe11006d3b.png#averageHue=%23fdf9f9&clientId=uc440a240-4b2c-4&from=paste&height=505&id=uba6ca174&originHeight=505&originWidth=1355&originalType=binary&ratio=1&rotation=0&showTitle=false&size=90797&status=done&style=none&taskId=ub7b7f445-b4a6-40b3-bda2-9743906f91d&title=&width=1355" alt="image.png"><br>新建my.cnf，通过容器卷同步给mysql容器实例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default_character_set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">collation_server = utf8_general_ci</span><br><span class="line">character_set_server = utf8</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658385982627-5fe54dbd-eb94-4d5d-a7ea-354e1be76f35.png#averageHue=%23fefbfb&clientId=uc440a240-4b2c-4&from=paste&height=269&id=ud3c83c7e&originHeight=269&originWidth=756&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31723&status=done&style=none&taskId=u7e2159ce-0592-4700-a9e0-2d3cb7c854e&title=&width=756" alt="image.png"><br>重新启动mysql容器实例再重新进入并查看字符编码<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658386018656-712d254c-d270-4f17-aa62-cf93b98577d3.png#averageHue=%23fef5f5&clientId=uc440a240-4b2c-4&from=paste&height=306&id=uc1353d22&originHeight=306&originWidth=668&originalType=binary&ratio=1&rotation=0&showTitle=false&size=52840&status=done&style=none&taskId=ubb0b2789-1f17-484d-87a1-7d7114d201f&title=&width=668" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658386026933-dee09e82-39a2-4699-bb63-3930d3e8ba6e.png#averageHue=%23fefefe&clientId=uc440a240-4b2c-4&from=paste&height=295&id=u6f78d5bd&originHeight=295&originWidth=662&originalType=binary&ratio=1&rotation=0&showTitle=false&size=36853&status=done&style=none&taskId=u3a521c11-a803-40a5-9ac2-d75a19ac594&title=&width=662" alt="image.png"><br>再新建库新建表再插入中文测试<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658386040814-18b11add-9638-4461-ab79-81799679f00c.png#averageHue=%23fef8f8&clientId=uc440a240-4b2c-4&from=paste&height=319&id=u4020a51a&originHeight=319&originWidth=741&originalType=binary&ratio=1&rotation=0&showTitle=false&size=26706&status=done&style=none&taskId=u0322b07f-99c6-4b1b-bed4-a6986a0e5a1&title=&width=741" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658386045922-c04af725-cacb-4b76-a885-4cdbb82b2cc7.png#averageHue=%23efd9a1&clientId=uc440a240-4b2c-4&from=paste&height=332&id=u73b81a6f&originHeight=332&originWidth=569&originalType=binary&ratio=1&rotation=0&showTitle=false&size=27215&status=done&style=none&taskId=u1e38a886-e3b4-44a2-b232-249cfdd2b1d&title=&width=569" alt="image.png"><br>结论<br>之前的DB  无效，修改字符集操作+重启mysql容器实例<br>之后的DB  有效，需要新建<br>结论：docker安装完MySQL并run出容器后，建议请先修改完字符集编码后再新建mysql库-表-插数据<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658386205878-9ade8aa5-cc6e-455a-b6d1-5b70344c05d9.png#averageHue=%23fef9f9&clientId=uc440a240-4b2c-4&from=paste&height=454&id=u90da3c99&originHeight=454&originWidth=649&originalType=binary&ratio=1&rotation=0&showTitle=false&size=56729&status=done&style=none&taskId=u13727a7b-e8b4-4365-b668-2fd1ec80648&title=&width=649" alt="image.png"><br>假如将当前容器实例删除，再重新来一次，之前建的db01实例还有吗？try</p>
<h2 id="8-4-安装redis"><a href="#8-4-安装redis" class="headerlink" title="8.4 安装redis"></a>8.4 安装redis</h2><ol>
<li><strong>从docker hub上(阿里云加速器)拉取redis镜像到本地标签为6.0.8</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658386269314-4f582385-baa4-478e-8dbe-d8e3cea4b808.png#averageHue=%23fef9f9&clientId=uc440a240-4b2c-4&from=paste&height=390&id=u526e0c3a&originHeight=390&originWidth=1223&originalType=binary&ratio=1&rotation=0&showTitle=false&size=80570&status=done&style=none&taskId=uda683584-9d51-4618-99ab-f9f097725d7&title=&width=1223" alt="image.png"></p>
<ol start="2">
<li><strong>入门命令</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658386283541-4dd83134-4c11-46e9-b6ca-de55f10d25ec.png#averageHue=%23fefbfb&clientId=uc440a240-4b2c-4&from=paste&height=420&id=u4585dcc9&originHeight=420&originWidth=1350&originalType=binary&ratio=1&rotation=0&showTitle=false&size=77457&status=done&style=none&taskId=u2f41fc31-3b9a-417a-82cb-f9bc81631dc&title=&width=1350" alt="image.png"></p>
<ol start="3">
<li><strong>命令提醒：容器卷记得加入–privileged&#x3D;true</strong></li>
</ol>
<p>Docker挂载主机目录Docker访问出现cannot open directory .: Permission denied<br>解决办法：在挂载目录后多加一个–privileged&#x3D;true参数即可</p>
<ol start="4">
<li><strong>在CentOS宿主机下新建目录&#x2F;app&#x2F;redis</strong></li>
</ol>
<p><code>mkdir -p /app/redis</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658386476816-44e3daec-8880-48c2-9412-4997a1b0cd86.png#averageHue=%23fefafa&clientId=uc440a240-4b2c-4&from=paste&height=187&id=uefa5e9a8&originHeight=187&originWidth=527&originalType=binary&ratio=1&rotation=0&showTitle=false&size=23096&status=done&style=none&taskId=u9718fd14-c8c8-4e42-b0ea-d021340f003&title=&width=527" alt="image.png"></p>
<ol start="5">
<li><strong>将一个redis.conf文件模板拷贝进&#x2F;app&#x2F;redis目录下</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658386499130-3dfd0b28-9053-4a8a-8089-d02cfac2eabc.png#averageHue=%23fef7f7&clientId=uc440a240-4b2c-4&from=paste&height=311&id=u07be212b&originHeight=311&originWidth=665&originalType=binary&ratio=1&rotation=0&showTitle=false&size=39614&status=done&style=none&taskId=uaaca4be9-a0b1-4db7-ab23-062bac632b6&title=&width=665" alt="image.png"><br>将准备好的redis.conf文件放进&#x2F;app&#x2F;redis目录下</p>
<ol start="6">
<li><strong>&#x2F;app&#x2F;redis目录下修改redis.conf文件</strong></li>
</ol>
<p>默认出厂的原始redis.conf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Redis configuration file example.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Note that in order to read the configuration file, Redis must be</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">started with the file path as first argument:</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># ./redis-server /path/to/redis.conf</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Note on units: when memory size is needed, it is possible to specify</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">it <span class="keyword">in</span> the usual form of 1k 5GB 4M and so forth:</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 1k =&gt; 1000 bytes</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1kb =&gt; 1024 bytes</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1m =&gt; 1000000 bytes</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1mb =&gt; 1024*1024 bytes</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1g =&gt; 1000000000 bytes</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1gb =&gt; 1024*1024*1024 bytes</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">################################# INCLUDES ###################################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Include one or more other config files here.  This is useful <span class="keyword">if</span> you</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">have a standard template that goes to all Redis servers but also need</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">to customize a few per-server settings.  Include files can include</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">other files, so use this wisely.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Notice option &quot;include&quot; won&#x27;t be rewritten by command &quot;CONFIG REWRITE&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">from admin or Redis Sentinel. Since Redis always uses the last processed</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">line as value of a configuration directive, you<span class="string">&#x27;d better put includes</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">at the beginning of this file to avoid overwriting config change at runtime.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># If instead you are interested in using includes to override configuration</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">options, it is better to use include as the last line.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># include /path/to/local.conf</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">include /path/to/other.conf</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">################################# MODULES #####################################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Load modules at startup. If the server is not able to load modules</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">it will abort. It is possible to use multiple loadmodule directives.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># loadmodule /path/to/my_module.so</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">loadmodule /path/to/other_module.so</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">################################# NETWORK #####################################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">By default, if no &quot;bind&quot; configuration directive is specified, Redis listens</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">for connections from all the network interfaces available on the server.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">It is possible to listen to just one or multiple selected interfaces using</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the &quot;bind&quot; configuration directive, followed by one or more IP addresses.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Examples:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># bind 192.168.1.100 10.0.0.1</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">bind 127.0.0.1 ::1</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># ~~~ WARNING ~~~ If the computer running Redis is directly exposed to the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">internet, binding to all the interfaces is dangerous and will expose the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">instance to everybody on the internet. So by default we uncomment the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">following bind directive, that will force Redis to listen only into</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the IPv4 loopback interface address (this means Redis will be able to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">accept connections only from clients running into the same computer it</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">is running).</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># IF YOU ARE SURE YOU WANT YOUR INSTANCE TO LISTEN TO ALL THE INTERFACES</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">JUST COMMENT THE FOLLOWING LINE.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">bind 127.0.0.1</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Protected mode is a layer of security protection, in order to avoid that</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Redis instances left open on the internet are accessed and exploited.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># When protected mode is on and if:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># 1) The server is not binding explicitly to a set of addresses using the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   &quot;bind&quot; directive.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">2) No password is configured.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The server only accepts connections from clients connecting from the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">IPv4 and IPv6 loopback addresses 127.0.0.1 and ::1, and from Unix domain</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">sockets.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># By default protected mode is enabled. You should disable it only if</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">you are sure you want clients from other hosts to connect to Redis</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">even if no authentication is configured, nor a specific set of interfaces</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">are explicitly listed using the &quot;bind&quot; directive.</span></span></span><br><span class="line">protected-mode no</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Accept connections on the specified port, default is 6379 (IANA #815344).</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">If port 0 is specified Redis will not listen on a TCP socket.</span></span></span><br><span class="line">port 6379</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">TCP listen() backlog.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># In high requests-per-second environments you need an high backlog in order</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">to avoid slow clients connections issues. Note that the Linux kernel</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">will silently truncate it to the value of /proc/sys/net/core/somaxconn so</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">make sure to raise both the value of somaxconn and tcp_max_syn_backlog</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">in order to get the desired effect.</span></span></span><br><span class="line">tcp-backlog 511</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Unix socket.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Specify the path for the Unix socket that will be used to listen for</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">incoming connections. There is no default, so Redis will not listen</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">on a unix socket when not specified.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># unixsocket /tmp/redis.sock</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">unixsocketperm 700</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Close the connection after a client is idle for N seconds (0 to disable)</span></span></span><br><span class="line">timeout 0</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">TCP keepalive.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients in absence</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">of communication. This is useful for two reasons:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># 1) Detect dead peers.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">2) Take the connection alive from the point of view of network</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   equipment in the middle.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># On Linux, the specified value (in seconds) is the period used to send ACKs.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Note that to close the connection the double of the time is needed.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">On other kernels the period depends on the kernel configuration.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># A reasonable value for this option is 300 seconds, which is the new</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Redis default starting with Redis 3.2.1.</span></span></span><br><span class="line">tcp-keepalive 300</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">################################ GENERAL #####################################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">By default Redis does not run as a daemon. Use &#x27;</span><span class="built_in">yes</span><span class="string">&#x27; if you need it.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Note that Redis will write a pid file in /var/run/redis.pid when daemonized.</span></span></span><br><span class="line">daemonize no</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">If you run Redis from upstart or systemd, Redis can interact with your</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">supervision tree. Options:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  supervised no      - no supervision interaction</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  supervised upstart - signal upstart by putting Redis into SIGSTOP mode</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  supervised systemd - signal systemd by writing READY=1 to $NOTIFY_SOCKET</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  supervised auto    - detect upstart or systemd method based on</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">                       UPSTART_JOB or NOTIFY_SOCKET environment variables</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Note: these supervision methods only signal &quot;process is ready.&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">      They do not enable continuous liveness pings back to your supervisor.</span></span></span><br><span class="line">supervised no</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">If a pid file is specified, Redis writes it where specified at startup</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">and removes it at exit.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># When the server runs non daemonized, no pid file is created if none is</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">specified in the configuration. When the server is daemonized, the pid file</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">is used even if not specified, defaulting to &quot;/var/run/redis.pid&quot;.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Creating a pid file is best effort: if Redis is not able to create it</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">nothing bad happens, the server will start and run normally.</span></span></span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Specify the server verbosity level.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">This can be one of:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">debug (a lot of information, useful for development/testing)</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">verbose (many rarely useful info, but not a mess like the debug level)</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">notice (moderately verbose, what you want in production probably)</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">warning (only very important / critical messages are logged)</span></span></span><br><span class="line">loglevel notice</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Specify the log file name. Also the empty string can be used to force</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Redis to log on the standard output. Note that if you use standard</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">output for logging but daemonize, logs will be sent to /dev/null</span></span></span><br><span class="line">logfile &quot;&quot;</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">To enable logging to the system logger, just set &#x27;</span>syslog-enabled<span class="string">&#x27; to yes,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">and optionally update the other syslog parameters to suit your needs.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">syslog-enabled no</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Specify the syslog identity.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">syslog-ident redis</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Specify the syslog facility. Must be USER or between LOCAL0-LOCAL7.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">syslog-facility local0</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Set the number of databases. The default database is DB 0, you can select</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">a different one on a per-connection basis using SELECT &lt;dbid&gt; where</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">dbid is a number between 0 and &#x27;</span>databases<span class="string">&#x27;-1</span></span></span><br><span class="line">databases 16</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">By default Redis shows an ASCII art logo only when started to log to the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">standard output and if the standard output is a TTY. Basically this means</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">that normally a logo is displayed only in interactive sessions.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># However it is possible to force the pre-4.0 behavior and always show a</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">ASCII art logo in startup logs by setting the following option to yes.</span></span></span><br><span class="line">always-show-logo yes</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">############################### SNAPSHOTTING  ################################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Save the DB on disk:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#   save &lt;seconds&gt; &lt;changes&gt;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#   Will save the DB if both the given number of seconds and the given</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  number of write operations against the DB occurred.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#   In the example below the behaviour will be to save:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  after 900 sec (15 min) if at least 1 key changed</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  after 300 sec (5 min) if at least 10 keys changed</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  after 60 sec if at least 10000 keys changed</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#   Note: you can disable saving completely by commenting out all &quot;save&quot; lines.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#   It is also possible to remove all the previously configured save</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  points by adding a save directive with a single empty string argument</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  like in the following example:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#   save &quot;&quot;</span></span></span><br><span class="line"> </span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">By default Redis will stop accepting writes if RDB snapshots are enabled</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">(at least one save point) and the latest background save failed.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">This will make the user aware (in a hard way) that data is not persisting</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">on disk properly, otherwise chances are that no one will notice and some</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">disaster will happen.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># If the background saving process will start working again Redis will</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">automatically allow writes again.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># However if you have setup your proper monitoring of the Redis server</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">and persistence, you may want to disable this feature so that Redis will</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">continue to work as usual even if there are problems with disk,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">permissions, and so forth.</span></span></span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Compress string objects using LZF when dump .rdb databases?</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">For default that&#x27;</span>s <span class="built_in">set</span> to <span class="string">&#x27;yes&#x27;</span> as it<span class="string">&#x27;s almost always a win.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">If you want to save some CPU in the saving child set it to &#x27;</span>no<span class="string">&#x27; but</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the dataset will likely be bigger if you have compressible values or keys.</span></span></span><br><span class="line">rdbcompression yes</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Since version 5 of RDB a CRC64 checksum is placed at the end of the file.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">This makes the format more resistant to corruption but there is a performance</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">hit to pay (around 10%) when saving and loading RDB files, so you can disable it</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">for maximum performances.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># RDB files created with checksum disabled have a checksum of zero that will</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">tell the loading code to skip the check.</span></span></span><br><span class="line">rdbchecksum yes</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">The filename where to dump the DB</span></span></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">The working directory.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The DB will be written inside this directory, with the filename specified</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">above using the &#x27;</span>dbfilename<span class="string">&#x27; configuration directive.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The Append Only File will also be created inside this directory.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Note that you must specify a directory here, not a file name.</span></span></span><br><span class="line">dir ./</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">################################ REPLICATION #################################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Master-Replica replication. Use replicaof to make a Redis instance a copy of</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">another Redis server. A few things to understand ASAP about Redis replication.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#   +------------------+      +---------------+</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  |      Master      | ---&gt; |    Replica    |</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  | (receive writes) |      |  (exact copy) |</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  +------------------+      +---------------+</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># 1) Redis replication is asynchronous, but you can configure a master to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   stop accepting writes if it appears to be not connected with at least</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   a given number of replicas.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">2) Redis replicas are able to perform a partial resynchronization with the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   master if the replication link is lost for a relatively small amount of</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   time. You may want to configure the replication backlog size (see the next</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   sections of this file) with a sensible value depending on your needs.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">3) Replication is automatic and does not need user intervention. After a</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   network partition replicas automatically try to reconnect to masters</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   and resynchronize with them.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># replicaof &lt;masterip&gt; &lt;masterport&gt;</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">If the master is password protected (using the &quot;requirepass&quot; configuration</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">directive below) it is possible to tell the replica to authenticate before</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">starting the replication synchronization process, otherwise the master will</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">refuse the replica request.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># masterauth &lt;master-password&gt;</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">When a replica loses its connection with the master, or when the replication</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">is still in progress, the replica can act in two different ways:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># 1) if replica-serve-stale-data is set to &#x27;</span><span class="built_in">yes</span><span class="string">&#x27; (the default) the replica will</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   still reply to client requests, possibly with out of date data, or the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   data set may just be empty if this is the first synchronization.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># 2) if replica-serve-stale-data is set to &#x27;</span>no<span class="string">&#x27; the replica will reply with</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   an error &quot;SYNC with master in progress&quot; to all the kind of commands</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   but to INFO, replicaOF, AUTH, PING, SHUTDOWN, REPLCONF, ROLE, CONFIG,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   SUBSCRIBE, UNSUBSCRIBE, PSUBSCRIBE, PUNSUBSCRIBE, PUBLISH, PUBSUB,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   COMMAND, POST, HOST: and LATENCY.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">replica-serve-stale-data yes</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">You can configure a replica instance to accept writes or not. Writing against</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">a replica instance may be useful to store some ephemeral data (because data</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">written on a replica will be easily deleted after resync with the master) but</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">may also cause problems if clients are writing to it because of a</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">misconfiguration.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Since Redis 2.6 by default replicas are read-only.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Note: read only replicas are not designed to be exposed to untrusted clients</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">on the internet. It&#x27;</span>s just a protection layer against misuse of the instance.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Still a <span class="built_in">read</span> only replica exports by default all the administrative commands</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">such as CONFIG, DEBUG, and so forth. To a limited extent you can improve</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">security of <span class="built_in">read</span> only replicas using <span class="string">&#x27;rename-command&#x27;</span> to shadow all the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">administrative / dangerous commands.</span></span><br><span class="line">replica-read-only yes</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replication SYNC strategy: disk or socket.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># -------------------------------------------------------</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">WARNING: DISKLESS REPLICATION IS EXPERIMENTAL CURRENTLY</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-------------------------------------------------------</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># New replicas and reconnecting replicas that are not able to continue the replication</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">process just receiving differences, need to <span class="keyword">do</span> what is called a <span class="string">&quot;full</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">synchronization&quot;</span>. An RDB file is transmitted from the master to the replicas.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The transmission can happen <span class="keyword">in</span> two different ways:</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 1) Disk-backed: The Redis master creates a new process that writes the RDB</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                file on disk. Later the file is transferred by the parent</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                process to the replicas incrementally.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2) Diskless: The Redis master creates a new process that directly writes the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             RDB file to replica sockets, without touching the disk at all.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># With disk-backed replication, while the RDB file is generated, more replicas</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">can be queued and served with the RDB file as soon as the current child producing</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the RDB file finishes its work. With diskless replication instead once</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the transfer starts, new replicas arriving will be queued and a new transfer</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">will start when the current one terminates.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># When diskless replication is used, the master waits a configurable amount of</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">time (<span class="keyword">in</span> seconds) before starting the transfer <span class="keyword">in</span> the hope that multiple replicas</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">will arrive and the transfer can be parallelized.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># With slow disks and fast (large bandwidth) networks, diskless replication</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">works better.</span></span><br><span class="line">repl-diskless-sync no</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">When diskless replication is enabled, it is possible to configure the delay</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the server waits <span class="keyword">in</span> order to spawn the child that transfers the RDB via socket</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">to the replicas.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This is important since once the transfer starts, it is not possible to serve</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">new replicas arriving, that will be queued <span class="keyword">for</span> the next RDB transfer, so the server</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">waits a delay <span class="keyword">in</span> order to <span class="built_in">let</span> more replicas arrive.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># The delay is specified in seconds, and by default is 5 seconds. To disable</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">it entirely just <span class="built_in">set</span> it to 0 seconds and the transfer will start ASAP.</span></span><br><span class="line">repl-diskless-sync-delay 5</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replicas send PINGs to server <span class="keyword">in</span> a predefined interval. It<span class="string">&#x27;s possible to change</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">this interval with the repl_ping_replica_period option. The default value is 10</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">seconds.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># repl-ping-replica-period 10</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">The following option sets the replication timeout for:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># 1) Bulk transfer I/O during SYNC, from the point of view of replica.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">2) Master timeout from the point of view of replicas (data, pings).</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">3) Replica timeout from the point of view of masters (REPLCONF ACK pings).</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># It is important to make sure that this value is greater than the value</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">specified for repl-ping-replica-period otherwise a timeout will be detected</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">every time there is low traffic between the master and the replica.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># repl-timeout 60</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Disable TCP_NODELAY on the replica socket after SYNC?</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># If you select &quot;yes&quot; Redis will use a smaller number of TCP packets and</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">less bandwidth to send data to replicas. But this can add a delay for</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the data to appear on the replica side, up to 40 milliseconds with</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Linux kernels using a default configuration.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># If you select &quot;no&quot; the delay for data to appear on the replica side will</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">be reduced but more bandwidth will be used for replication.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># By default we optimize for low latency, but in very high traffic conditions</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">or when the master and replicas are many hops away, turning this to &quot;yes&quot; may</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">be a good idea.</span></span></span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Set the replication backlog size. The backlog is a buffer that accumulates</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">replica data when replicas are disconnected for some time, so that when a replica</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">wants to reconnect again, often a full resync is not needed, but a partial</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">resync is enough, just passing the portion of data the replica missed while</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">disconnected.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The bigger the replication backlog, the longer the time the replica can be</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">disconnected and later be able to perform a partial resynchronization.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The backlog is only allocated once there is at least a replica connected.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># repl-backlog-size 1mb</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">After a master has no longer connected replicas for some time, the backlog</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">will be freed. The following option configures the amount of seconds that</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">need to elapse, starting from the time the last replica disconnected, for</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the backlog buffer to be freed.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Note that replicas never free the backlog for timeout, since they may be</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">promoted to masters later, and should be able to correctly &quot;partially</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">resynchronize&quot; with the replicas: hence they should always accumulate backlog.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># A value of 0 means to never release the backlog.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># repl-backlog-ttl 3600</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">The replica priority is an integer number published by Redis in the INFO output.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">It is used by Redis Sentinel in order to select a replica to promote into a</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">master if the master is no longer working correctly.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># A replica with a low priority number is considered better for promotion, so</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">for instance if there are three replicas with priority 10, 100, 25 Sentinel will</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">pick the one with priority 10, that is the lowest.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># However a special priority of 0 marks the replica as not able to perform the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">role of master, so a replica with priority of 0 will never be selected by</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Redis Sentinel for promotion.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># By default the priority is 100.</span></span></span><br><span class="line">replica-priority 100</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">It is possible for a master to stop accepting writes if there are less than</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">N replicas connected, having a lag less or equal than M seconds.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The N replicas need to be in &quot;online&quot; state.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The lag in seconds, that must be &lt;= the specified value, is calculated from</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the last ping received from the replica, that is usually sent every second.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># This option does not GUARANTEE that N replicas will accept the write, but</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">will limit the window of exposure for lost writes in case not enough replicas</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">are available, to the specified number of seconds.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># For example to require at least 3 replicas with a lag &lt;= 10 seconds use:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># min-replicas-to-write 3</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">min-replicas-max-lag 10</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Setting one or the other to 0 disables the feature.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># By default min-replicas-to-write is set to 0 (feature disabled) and</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">min-replicas-max-lag is set to 10.</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">A Redis master is able to list the address and port of the attached</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">replicas in different ways. For example the &quot;INFO replication&quot; section</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">offers this information, which is used, among other tools, by</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Redis Sentinel in order to discover replica instances.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Another place where this info is available is in the output of the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;ROLE&quot; command of a master.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The listed IP and address normally reported by a replica is obtained</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">in the following way:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#   IP: The address is auto detected by checking the peer address</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  of the socket used by the replica to connect with the master.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#   Port: The port is communicated by the replica during the replication</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  handshake, and is normally the port that the replica is using to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  listen for connections.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># However when port forwarding or Network Address Translation (NAT) is</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">used, the replica may be actually reachable via different IP and port</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">pairs. The following two options can be used by a replica in order to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">report to its master a specific set of IP and port, so that both INFO</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">and ROLE will report those values.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># There is no need to use both the options if you need to override just</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the port or the IP address.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># replica-announce-ip 5.5.5.5</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">replica-announce-port 1234</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">################################# SECURITY ###################################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Require clients to issue AUTH &lt;PASSWORD&gt; before processing any other</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">commands.  This might be useful in environments in which you do not trust</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">others with access to the host running redis-server.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># This should stay commented out for backward compatibility and because most</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">people do not need auth (e.g. they run their own servers).</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Warning: since Redis is pretty fast an outside user can try up to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">150k passwords per second against a good box. This means that you should</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">use a very strong password otherwise it will be very easy to break.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># requirepass foobared</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Command renaming.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># It is possible to change the name of dangerous commands in a shared</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">environment. For instance the CONFIG command may be renamed into something</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">hard to guess so that it will still be available for internal-use tools</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">but not available for general clients.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Example:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># It is also possible to completely kill a command by renaming it into</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">an empty string:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># rename-command CONFIG &quot;&quot;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Please note that changing the name of commands that are logged into the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">AOF file or transmitted to replicas may cause problems.</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">################################## CLIENTS ####################################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Set the max number of connected clients at the same time. By default</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">this limit is set to 10000 clients, however if the Redis server is not</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">able to configure the process file limit to allow for the specified limit</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the max number of allowed clients is set to the current file limit</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">minus 32 (as Redis reserves a few file descriptors for internal uses).</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Once the limit is reached Redis will close all the new connections sending</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">an error &#x27;</span>max number of clients reached<span class="string">&#x27;.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># maxclients 10000</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">############################# MEMORY MANAGEMENT ################################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Set a memory usage limit to the specified amount of bytes.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">When the memory limit is reached Redis will try to remove keys</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">according to the eviction policy selected (see maxmemory-policy).</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># If Redis can&#x27;</span>t remove keys according to the policy, or <span class="keyword">if</span> the policy is</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">set</span> to <span class="string">&#x27;noeviction&#x27;</span>, Redis will start to reply with errors to commands</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">that would use more memory, like SET, LPUSH, and so on, and will <span class="built_in">continue</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">to reply to read-only commands like GET.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This option is usually useful when using Redis as an LRU or LFU cache, or to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">set</span> a hard memory <span class="built_in">limit</span> <span class="keyword">for</span> an instance (using the <span class="string">&#x27;noeviction&#x27;</span> policy).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># WARNING: If you have replicas attached to an instance with maxmemory on,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the size of the output buffers needed to feed the replicas are subtracted</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">from the used memory count, so that network problems / resyncs will</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">not trigger a loop <span class="built_in">where</span> keys are evicted, and <span class="keyword">in</span> turn the output</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">buffer of replicas is full with DELs of keys evicted triggering the deletion</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">of more keys, and so forth <span class="keyword">until</span> the database is completely emptied.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># In short... if you have replicas attached it is suggested that you set a lower</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">limit</span> <span class="keyword">for</span> maxmemory so that there is some free RAM on the system <span class="keyword">for</span> replica</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">output buffers (but this is not needed <span class="keyword">if</span> the policy is <span class="string">&#x27;noeviction&#x27;</span>).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># maxmemory &lt;bytes&gt;</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MAXMEMORY POLICY: how Redis will <span class="keyword">select</span> what to remove when maxmemory</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">is reached. You can <span class="keyword">select</span> among five behaviors:</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># volatile-lru -&gt; Evict using approximated LRU among the keys with an expire set.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">allkeys-lru -&gt; Evict any key using approximated LRU.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">volatile-lfu -&gt; Evict using approximated LFU among the keys with an expire <span class="built_in">set</span>.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">allkeys-lfu -&gt; Evict any key using approximated LFU.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">volatile-random -&gt; Remove a random key among the ones with an expire <span class="built_in">set</span>.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">allkeys-random -&gt; Remove a random key, any key.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">noeviction -&gt; Don<span class="string">&#x27;t evict anything, just return an error on write operations.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># LRU means Least Recently Used</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">LFU means Least Frequently Used</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Both LRU, LFU and volatile-ttl are implemented using approximated</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">randomized algorithms.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Note: with any of the above policies, Redis will return an error on write</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">      operations, when there are no suitable keys for eviction.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#       At the date of writing these commands are: set setnx setex append</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">      incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">      sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">      zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">      getset mset msetnx exec sort</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The default is:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># maxmemory-policy noeviction</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">LRU, LFU and minimal TTL algorithms are not precise algorithms but approximated</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">algorithms (in order to save memory), so you can tune it for speed or</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">accuracy. For default Redis will check five keys and pick the one that was</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">used less recently, you can change the sample size using the following</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">configuration directive.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The default of 5 produces good enough results. 10 Approximates very closely</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">true LRU but costs more CPU. 3 is faster but not very accurate.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># maxmemory-samples 5</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Starting from Redis 5, by default a replica will ignore its maxmemory setting</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">(unless it is promoted to master after a failover or manually). It means</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">that the eviction of keys will be just handled by the master, sending the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">DEL commands to the replica as keys evict in the master side.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># This behavior ensures that masters and replicas stay consistent, and is usually</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">what you want, however if your replica is writable, or you want the replica to have</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">a different memory setting, and you are sure all the writes performed to the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">replica are idempotent, then you may change this default (but be sure to understand</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">what you are doing).</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Note that since the replica by default does not evict, it may end using more</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">memory than the one set via maxmemory (there are certain buffers that may</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">be larger on the replica, or data structures may sometimes take more memory and so</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">forth). So make sure you monitor your replicas and make sure they have enough</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">memory to never hit a real out-of-memory condition before the master hits</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the configured maxmemory setting.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># replica-ignore-maxmemory yes</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">############################ LAZY FREEING ####################################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Redis has two primitives to delete keys. One is called DEL and is a blocking</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">deletion of the object. It means that the server stops processing new commands</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">in order to reclaim all the memory associated with an object in a synchronous</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">way. If the key deleted is associated with a small object, the time needed</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">in order to execute the DEL command is very small and comparable to most other</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">O(1) or O(log_N) commands in Redis. However if the key is associated with an</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">aggregated value containing millions of elements, the server can block for</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">a long time (even seconds) in order to complete the operation.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># For the above reasons Redis also offers non blocking deletion primitives</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">such as UNLINK (non blocking DEL) and the ASYNC option of FLUSHALL and</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">FLUSHDB commands, in order to reclaim memory in background. Those commands</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">are executed in constant time. Another thread will incrementally free the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">object in the background as fast as possible.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># DEL, UNLINK and ASYNC option of FLUSHALL and FLUSHDB are user-controlled.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">It&#x27;</span>s up to the design of the application to understand when it is a good</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">idea to use one or the other. However the Redis server sometimes has to</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">delete keys or flush the whole database as a side effect of other operations.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Specifically Redis deletes objects independently of a user call <span class="keyword">in</span> the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">following scenarios:</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># 1) On eviction, because of the maxmemory and maxmemory policy configurations,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   <span class="keyword">in</span> order to make room <span class="keyword">for</span> new data, without going over the specified</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   memory <span class="built_in">limit</span>.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2) Because of expire: when a key with an associated time to live (see the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   EXPIRE <span class="built_in">command</span>) must be deleted from memory.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3) Because of a side effect of a <span class="built_in">command</span> that stores data on a key that may</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   already exist. For example the RENAME <span class="built_in">command</span> may delete the old key</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   content when it is replaced with another one. Similarly SUNIONSTORE</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   or SORT with STORE option may delete existing keys. The SET <span class="built_in">command</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   itself removes any old content of the specified key <span class="keyword">in</span> order to replace</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   it with the specified string.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4) During replication, when a replica performs a full resynchronization with</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   its master, the content of the whole database is removed <span class="keyword">in</span> order to</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   load the RDB file just transferred.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># In all the above cases the default is to delete objects in a blocking way,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">like <span class="keyword">if</span> DEL was called. However you can configure each <span class="keyword">case</span> specifically</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">in</span> order to instead release memory <span class="keyword">in</span> a non-blocking way like <span class="keyword">if</span> UNLINK</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">was called, using the following configuration directives:</span></span><br><span class="line"> </span><br><span class="line">lazyfree-lazy-eviction no</span><br><span class="line">lazyfree-lazy-expire no</span><br><span class="line">lazyfree-lazy-server-del no</span><br><span class="line">replica-lazy-flush no</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">############################# APPEND ONLY MODE ###############################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">By default Redis asynchronously dumps the dataset on disk. This mode is</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">good enough <span class="keyword">in</span> many applications, but an issue with the Redis process or</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a power outage may result into a few minutes of writes lost (depending on</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the configured save points).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># The Append Only File is an alternative persistence mode that provides</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">much better durability. For instance using the default data fsync policy</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">(see later <span class="keyword">in</span> the config file) Redis can lose just one second of writes <span class="keyword">in</span> a</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">dramatic event like a server power outage, or a single write <span class="keyword">if</span> something</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">wrong with the Redis process itself happens, but the operating system is</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">still running correctly.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># AOF and RDB persistence can be enabled at the same time without problems.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">If the AOF is enabled on startup Redis will load the AOF, that is the file</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">with the better durability guarantees.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Please check http://redis.io/topics/persistence for more information.</span></span></span><br><span class="line"> </span><br><span class="line">appendonly no</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The name of the append only file (default: <span class="string">&quot;appendonly.aof&quot;</span>)</span></span><br><span class="line"> </span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The fsync() call tells the Operating System to actually write data on disk</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">instead of waiting <span class="keyword">for</span> more data <span class="keyword">in</span> the output buffer. Some OS will really flush</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">data on disk, some other OS will just try to <span class="keyword">do</span> it ASAP.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Redis supports three different modes:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># no: don&#x27;t fsync, just let the OS flush the data when it wants. Faster.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">always: fsync after every write to the append only <span class="built_in">log</span>. Slow, Safest.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">everysec: fsync only one time every second. Compromise.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># The default is &quot;everysec&quot;, as that&#x27;s usually the right compromise between</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">speed and data safety. It<span class="string">&#x27;s up to you to understand if you can relax this to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;no&quot; that will let the operating system flush the output buffer when</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">it wants, for better performances (but if you can live with the idea of</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">some data loss consider the default persistence mode that&#x27;</span>s snapshotting),</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or on the contrary, use <span class="string">&quot;always&quot;</span> that<span class="string">&#x27;s very slow but a bit safer than</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">everysec.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># More details please check the following article:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">http://antirez.com/post/redis-persistence-demystified.html</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># If unsure, use &quot;everysec&quot;.</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">appendfsync always</span></span></span><br><span class="line">appendfsync everysec</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">appendfsync no</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">When the AOF fsync policy is set to always or everysec, and a background</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">saving process (a background save or AOF log background rewriting) is</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">performing a lot of I/O against the disk, in some Linux configurations</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Redis may block too long on the fsync() call. Note that there is no fix for</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">this currently, as even performing fsync in a different thread will block</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">our synchronous write(2) call.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># In order to mitigate this problem it&#x27;</span>s possible to use the following option</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">that will prevent fsync() from being called <span class="keyword">in</span> the main process <span class="keyword">while</span> a</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">BGSAVE or BGREWRITEAOF is <span class="keyword">in</span> progress.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This means that while another child is saving, the durability of Redis is</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the same as <span class="string">&quot;appendfsync none&quot;</span>. In practical terms, this means that it is</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">possible to lose up to 30 seconds of <span class="built_in">log</span> <span class="keyword">in</span> the worst scenario (with the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">default Linux settings).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># If you have latency problems turn this to &quot;yes&quot;. Otherwise leave it as</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;no&quot;</span> that is the safest pick from the point of view of durability.</span></span><br><span class="line"> </span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Automatic rewrite of the append only file.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Redis is able to automatically rewrite the <span class="built_in">log</span> file implicitly calling</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">BGREWRITEAOF when the AOF <span class="built_in">log</span> size grows by the specified percentage.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This is how it works: Redis remembers the size of the AOF file after the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">latest rewrite (<span class="keyword">if</span> no rewrite has happened since the restart, the size of</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the AOF at startup is used).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This base size is compared to the current size. If the current size is</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bigger than the specified percentage, the rewrite is triggered. Also</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">you need to specify a minimal size <span class="keyword">for</span> the AOF file to be rewritten, this</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">is useful to avoid rewriting the AOF file even <span class="keyword">if</span> the percentage increase</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">is reached but it is still pretty small.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Specify a percentage of zero in order to disable the automatic AOF</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rewrite feature.</span></span><br><span class="line"> </span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">An AOF file may be found to be truncated at the end during the Redis</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">startup process, when the AOF data gets loaded back into memory.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This may happen when the system <span class="built_in">where</span> Redis is running</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">crashes, especially when an ext4 filesystem is mounted without the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">data=ordered option (however this can<span class="string">&#x27;t happen when Redis itself</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">crashes or aborts but the operating system still works correctly).</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Redis can either exit with an error when this happens, or load as much</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">data as possible (the default now) and start if the AOF file is found</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">to be truncated at the end. The following option controls this behavior.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># If aof-load-truncated is set to yes, a truncated AOF file is loaded and</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the Redis server starts emitting a log to inform the user of the event.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Otherwise if the option is set to no, the server aborts with an error</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">and refuses to start. When the option is set to no, the user requires</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">to fix the AOF file using the &quot;redis-check-aof&quot; utility before to restart</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the server.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Note that if the AOF file will be found to be corrupted in the middle</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the server will still exit with an error. This option only applies when</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Redis will try to read more data from the AOF file but not enough bytes</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">will be found.</span></span></span><br><span class="line">aof-load-truncated yes</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">When rewriting the AOF file, Redis is able to use an RDB preamble in the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">AOF file for faster rewrites and recoveries. When this option is turned</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">on the rewritten AOF file is composed of two different stanzas:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#   [RDB file][AOF tail]</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># When loading Redis recognizes that the AOF file starts with the &quot;REDIS&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">string and loads the prefixed RDB file, and continues loading the AOF</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">tail.</span></span></span><br><span class="line">aof-use-rdb-preamble yes</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">############################### LUA SCRIPTING  ###############################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Max execution time of a Lua script in milliseconds.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># If the maximum execution time is reached Redis will log that a script is</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">still in execution after the maximum allowed time and will start to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">reply to queries with an error.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># When a long running script exceeds the maximum execution time only the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">SCRIPT KILL and SHUTDOWN NOSAVE commands are available. The first can be</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">used to stop a script that did not yet called write commands. The second</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">is the only way to shut down the server in the case a write command was</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">already issued by the script but the user doesn&#x27;</span>t want to <span class="built_in">wait</span> <span class="keyword">for</span> the natural</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">termination of the script.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Set it to 0 or a negative value for unlimited execution without warnings.</span></span></span><br><span class="line">lua-time-limit 5000</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">############################### REDIS CLUSTER  ###############################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Normal Redis instances can<span class="string">&#x27;t be part of a Redis Cluster; only nodes that are</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">started as cluster nodes can. In order to start a Redis instance as a</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">cluster node enable the cluster support uncommenting the following:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># cluster-enabled yes</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Every cluster node has a cluster configuration file. This file is not</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">intended to be edited by hand. It is created and updated by Redis nodes.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Every Redis Cluster node requires a different cluster configuration file.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Make sure that instances running in the same system do not have</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">overlapping cluster configuration file names.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># cluster-config-file nodes-6379.conf</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Cluster node timeout is the amount of milliseconds a node must be unreachable</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">for it to be considered in failure state.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Most other internal time limits are multiple of the node timeout.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># cluster-node-timeout 15000</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">A replica of a failing master will avoid to start a failover if its data</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">looks too old.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># There is no simple way for a replica to actually have an exact measure of</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">its &quot;data age&quot;, so the following two checks are performed:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># 1) If there are multiple replicas able to failover, they exchange messages</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   in order to try to give an advantage to the replica with the best</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   replication offset (more data from the master processed).</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   Replicas will try to get their rank by offset, and apply to the start</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   of the failover a delay proportional to their rank.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># 2) Every single replica computes the time of the last interaction with</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   its master. This can be the last ping or command received (if the master</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   is still in the &quot;connected&quot; state), or the time that elapsed since the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   disconnection with the master (if the replication link is currently down).</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   If the last interaction is too old, the replica will not try to failover</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   at all.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The point &quot;2&quot; can be tuned by user. Specifically a replica will not perform</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the failover if, since the last interaction with the master, the time</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">elapsed is greater than:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#   (node-timeout * replica-validity-factor) + repl-ping-replica-period</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># So for example if node-timeout is 30 seconds, and the replica-validity-factor</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">is 10, and assuming a default repl-ping-replica-period of 10 seconds, the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">replica will not try to failover if it was not able to talk with the master</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">for longer than 310 seconds.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># A large replica-validity-factor may allow replicas with too old data to failover</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">a master, while a too small value may prevent the cluster from being able to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">elect a replica at all.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># For maximum availability, it is possible to set the replica-validity-factor</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">to a value of 0, which means, that replicas will always try to failover the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">master regardless of the last time they interacted with the master.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">(However they&#x27;</span>ll always try to apply a delay proportional to their</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">offset rank).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Zero is the only value able to guarantee that when all the partitions heal</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">the cluster will always be able to <span class="built_in">continue</span>.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># cluster-replica-validity-factor 10</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Cluster replicas are able to migrate to orphaned masters, that are masters</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">that are left without working replicas. This improves the cluster ability</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">to resist to failures as otherwise an orphaned master can<span class="string">&#x27;t be failed over</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">in case of failure if it has no working replicas.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Replicas migrate to orphaned masters only if there are still at least a</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">given number of other working replicas for their old master. This number</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">is the &quot;migration barrier&quot;. A migration barrier of 1 means that a replica</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">will migrate only if there is at least 1 other working replica for its master</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">and so forth. It usually reflects the number of replicas you want for every</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">master in your cluster.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Default is 1 (replicas migrate only if their masters remain with at least</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">one replica). To disable migration just set it to a very large value.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">A value of 0 can be set but is useful only for debugging and dangerous</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">in production.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># cluster-migration-barrier 1</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">By default Redis Cluster nodes stop accepting queries if they detect there</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">is at least an hash slot uncovered (no available node is serving it).</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">This way if the cluster is partially down (for example a range of hash slots</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">are no longer covered) all the cluster becomes, eventually, unavailable.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">It automatically returns available as soon as all the slots are covered again.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># However sometimes you want the subset of the cluster which is working,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">to continue to accept queries for the part of the key space that is still</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">covered. In order to do so, just set the cluster-require-full-coverage</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">option to no.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># cluster-require-full-coverage yes</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">This option, when set to yes, prevents replicas from trying to failover its</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">master during master failures. However the master can still perform a</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">manual failover, if forced to do so.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># This is useful in different scenarios, especially in the case of multiple</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">data center operations, where we want one side to never be promoted if not</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">in the case of a total DC failure.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># cluster-replica-no-failover no</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">In order to setup your cluster make sure to read the documentation</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">available at http://redis.io web site.</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">######################### CLUSTER DOCKER/NAT support  ########################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">In certain deployments, Redis Cluster nodes address discovery fails, because</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">addresses are NAT-ted or because ports are forwarded (the typical case is</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Docker and other containers).</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># In order to make Redis Cluster working in such environments, a static</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">configuration where each node knows its public address is needed. The</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">following two options are used for this scope, and are:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># * cluster-announce-ip</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">* cluster-announce-port</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">* cluster-announce-bus-port</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Each instruct the node about its address, client port, and cluster message</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">bus port. The information is then published in the header of the bus packets</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">so that other nodes will be able to correctly map the address of the node</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">publishing the information.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># If the above options are not used, the normal Redis Cluster auto-detection</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">will be used instead.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Note that when remapped, the bus port may not be at the fixed offset of</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">clients port + 10000, so you can specify any port and bus-port depending</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">on how they get remapped. If the bus-port is not set, a fixed offset of</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">10000 will be used as usually.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Example:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># cluster-announce-ip 10.1.1.5</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">cluster-announce-port 6379</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">cluster-announce-bus-port 6380</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">################################# SLOW LOG ###################################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">The Redis Slow Log is a system to log queries that exceeded a specified</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">execution time. The execution time does not include the I/O operations</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">like talking with the client, sending the reply and so forth,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">but just the time needed to actually execute the command (this is the only</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">stage of command execution where the thread is blocked and can not serve</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">other requests in the meantime).</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># You can configure the slow log with two parameters: one tells Redis</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">what is the execution time, in microseconds, to exceed in order for the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">command to get logged, and the other parameter is the length of the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">slow log. When a new command is logged the oldest one is removed from the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">queue of logged commands.</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">The following time is expressed in microseconds, so 1000000 is equivalent</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">to one second. Note that a negative number disables the slow log, while</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">a value of zero forces the logging of every command.</span></span></span><br><span class="line">slowlog-log-slower-than 10000</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">There is no limit to this length. Just be aware that it will consume memory.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">You can reclaim memory used by the slow log with SLOWLOG RESET.</span></span></span><br><span class="line">slowlog-max-len 128</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">############################### LATENCY MONITOR ##############################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">The Redis latency monitoring subsystem samples different operations</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">at runtime in order to collect data related to possible sources of</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">latency of a Redis instance.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Via the LATENCY command this information is available to the user that can</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">print graphs and obtain reports.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The system only logs operations that were performed in a time equal or</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">greater than the amount of milliseconds specified via the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">latency-monitor-threshold configuration directive. When its value is set</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">to zero, the latency monitor is turned off.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># By default latency monitoring is disabled since it is mostly not needed</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">if you don&#x27;</span>t have latency issues, and collecting data has a performance</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">impact, that <span class="keyword">while</span> very small, can be measured under big load. Latency</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">monitoring can easily be enabled at runtime using the <span class="built_in">command</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">&quot;CONFIG SET latency-monitor-threshold &lt;milliseconds&gt;&quot;</span> <span class="keyword">if</span> needed.</span></span><br><span class="line">latency-monitor-threshold 0</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">############################ EVENT NOTIFICATION ##############################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Redis can notify Pub/Sub clients about events happening <span class="keyword">in</span> the key space.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">This feature is documented at http://redis.io/topics/notifications</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># For instance if keyspace events notification is enabled, and a client</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">performs a DEL operation on key <span class="string">&quot;foo&quot;</span> stored <span class="keyword">in</span> the Database 0, two</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">messages will be published via Pub/Sub:</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># PUBLISH __keyspace@0__:foo del</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">PUBLISH __keyevent@0__:del foo</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># It is possible to select the events that Redis will notify among a set</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">of classes. Every class is identified by a single character:</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#  K     Keyspace events, published with __keyspace@&lt;db&gt;__ prefix.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> E     Keyevent events, published with __keyevent@&lt;db&gt;__ prefix.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> g     Generic commands (non-type specific) like DEL, EXPIRE, RENAME, ...</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> $     String commands</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> l     List commands</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> s     Set commands</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> h     Hash commands</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> z     Sorted <span class="built_in">set</span> commands</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> x     Expired events (events generated every time a key expires)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> e     Evicted events (events generated when a key is evicted <span class="keyword">for</span> maxmemory)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> A     Alias <span class="keyword">for</span> g<span class="variable">$lshzxe</span>, so that the <span class="string">&quot;AKE&quot;</span> string means all the events.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#  The &quot;notify-keyspace-events&quot; takes as argument a string that is composed</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> of zero or multiple characters. The empty string means that notifications</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> are disabled.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#  Example: to enable list and generic events, from the point of view of the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">          event name, use:</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#  notify-keyspace-events Elg</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#  Example 2: to get the stream of the expired keys subscribing to channel</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">            name __keyevent@0__:expired use:</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">  notify-keyspace-events Ex</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#  By default all notifications are disabled because most users don&#x27;t need</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> this feature and the feature has some overhead. Note that <span class="keyword">if</span> you don<span class="string">&#x27;t</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string"> specify at least one of K or E, no events will be delivered.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">notify-keyspace-events &quot;&quot;</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">############################## ADVANCED CONFIG ###############################</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Hashes are encoded using a memory efficient data structure when they have a</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">small number of entries, and the biggest entry does not exceed a given</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">threshold. These thresholds can be configured using the following directives.</span></span></span><br><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Lists are also encoded in a special way to save a lot of space.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">The number of entries allowed per internal list node can be specified</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">as a fixed maximum size or a maximum number of elements.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">For a fixed maximum size, use -5 through -1, meaning:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">-5: max size: 64 Kb  &lt;-- not recommended for normal workloads</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">-4: max size: 32 Kb  &lt;-- not recommended</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">-3: max size: 16 Kb  &lt;-- probably not recommended</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">-2: max size: 8 Kb   &lt;-- good</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">-1: max size: 4 Kb   &lt;-- good</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Positive numbers mean store up to _exactly_ that number of elements</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">per list node.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">The highest performing option is usually -2 (8 Kb size) or -1 (4 Kb size),</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">but if your use case is unique, adjust the settings as necessary.</span></span></span><br><span class="line">list-max-ziplist-size -2</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Lists may also be compressed.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Compress depth is the number of quicklist ziplist nodes from *each* side of</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the list to *exclude* from compression.  The head and tail of the list</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">are always uncompressed for fast push/pop operations.  Settings are:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">0: disable all list compression</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">1: depth 1 means &quot;don&#x27;</span>t start compressing <span class="keyword">until</span> after 1 node into the list,</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   going from either the <span class="built_in">head</span> or <span class="built_in">tail</span><span class="string">&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   So: [head]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[tail]</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   [head], [tail] will always be uncompressed; inner nodes will compress.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">2: [head]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[tail]</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   2 here means: don&#x27;t compress head or head-&gt;next or tail-&gt;prev or tail,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   but compress all nodes between them.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">3: [head]-&gt;[next]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[prev]-&gt;[tail]</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">etc.</span></span></span><br><span class="line">list-compress-depth 0</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Sets have a special encoding in just one case: when a set is composed</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">of just strings that happen to be integers in radix 10 in the range</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">of 64 bit signed integers.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">The following configuration setting sets the limit in the size of the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">set in order to use this special memory saving encoding.</span></span></span><br><span class="line">set-max-intset-entries 512</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Similarly to hashes and lists, sorted sets are also specially encoded in</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">order to save a lot of space. This encoding is only used when the length and</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">elements of a sorted set are below the following limits:</span></span></span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">HyperLogLog sparse representation bytes limit. The limit includes the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">16 bytes header. When an HyperLogLog using the sparse representation crosses</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">this limit, it is converted into the dense representation.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># A value greater than 16000 is totally useless, since at that point the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">dense representation is more memory efficient.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The suggested value is ~ 3000 in order to have the benefits of</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the space efficient encoding without slowing down too much PFADD,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">which is O(N) with the sparse encoding. The value can be raised to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">~ 10000 when CPU is not a concern, but space is, and the data set is</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">composed of many HyperLogLogs with cardinality in the 0 - 15000 range.</span></span></span><br><span class="line">hll-sparse-max-bytes 3000</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Streams macro node max size / items. The stream data structure is a radix</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">tree of big nodes that encode multiple items inside. Using this configuration</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">it is possible to configure how big a single node can be in bytes, and the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">maximum number of items it may contain before switching to a new node when</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">appending new stream entries. If any of the following settings are set to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">zero, the limit is ignored, so for instance it is possible to set just a</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">max entires limit by setting max-bytes to 0 and max-entries to the desired</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">value.</span></span></span><br><span class="line">stream-node-max-bytes 4096</span><br><span class="line">stream-node-max-entries 100</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Active rehashing uses 1 millisecond every 100 milliseconds of CPU time in</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">order to help rehashing the main Redis hash table (the one mapping top-level</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">keys to values). The hash table implementation Redis uses (see dict.c)</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">performs a lazy rehashing: the more operation you run into a hash table</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">that is rehashing, the more rehashing &quot;</span>steps<span class="string">&quot; are performed, so if the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">server is idle the rehashing is never complete and some more memory is used</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">by the hash table.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The default is to use this millisecond 10 times every second in order to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">actively rehash the main dictionaries, freeing memory when possible.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># If unsure:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">use &quot;</span>activerehashing no<span class="string">&quot; if you have hard latency requirements and it is</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">not a good thing in your environment that Redis can reply from time to time</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">to queries with 2 milliseconds delay.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># use &quot;</span>activerehashing <span class="built_in">yes</span><span class="string">&quot; if you don&#x27;t have such hard requirements but</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">want to free memory asap when possible.</span></span></span><br><span class="line">activerehashing yes</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">The client output buffer limits can be used to force disconnection of clients</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">that are not reading data from the server fast enough for some reason (a</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">common reason is that a Pub/Sub client can&#x27;t consume messages as fast as the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">publisher can produce them).</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The limit can be set differently for the three different classes of clients:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># normal -&gt; normal clients including MONITOR clients</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">replica  -&gt; replica clients</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">pubsub -&gt; clients subscribed to at least one pubsub channel or pattern</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The syntax of every client-output-buffer-limit directive is the following:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># client-output-buffer-limit &lt;class&gt; &lt;hard limit&gt; &lt;soft limit&gt; &lt;soft seconds&gt;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># A client is immediately disconnected once the hard limit is reached, or if</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the soft limit is reached and remains reached for the specified number of</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">seconds (continuously).</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">So for instance if the hard limit is 32 megabytes and the soft limit is</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">16 megabytes / 10 seconds, the client will get disconnected immediately</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">if the size of the output buffers reach 32 megabytes, but will also get</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">disconnected if the client reaches 16 megabytes and continuously overcomes</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the limit for 10 seconds.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># By default normal clients are not limited because they don&#x27;t receive data</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">without asking (in a push way), but just after a request, so only</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">asynchronous clients may create a scenario where data is requested faster</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">than it can read.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Instead there is a default limit for pubsub and replica clients, since</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">subscribers and replicas receive data in a push fashion.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Both the hard or the soft limit can be disabled by setting them to zero.</span></span></span><br><span class="line">client-output-buffer-limit normal 0 0 0</span><br><span class="line">client-output-buffer-limit replica 256mb 64mb 60</span><br><span class="line">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Client query buffers accumulate new commands. They are limited to a fixed</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">amount by default in order to avoid that a protocol desynchronization (for</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">instance due to a bug in the client) will lead to unbound memory usage in</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the query buffer. However you can configure it here if you have very special</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">needs, such us huge multi/exec requests or alike.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># client-query-buffer-limit 1gb</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">In the Redis protocol, bulk requests, that are, elements representing single</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">strings, are normally limited ot 512 mb. However you can change this limit</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">here.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># proto-max-bulk-len 512mb</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Redis calls an internal function to perform many background tasks, like</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">closing connections of clients in timeout, purging expired keys that are</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">never requested, and so forth.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Not all tasks are performed with the same frequency, but Redis checks for</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">tasks to perform according to the specified &quot;</span>hz<span class="string">&quot; value.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># By default &quot;</span>hz<span class="string">&quot; is set to 10. Raising the value will use more CPU when</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Redis is idle, but at the same time will make Redis more responsive when</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">there are many keys expiring at the same time, and timeouts may be</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">handled with more precision.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The range is between 1 and 500, however a value over 100 is usually not</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">a good idea. Most users should use the default of 10 and raise this up to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">100 only in environments where very low latency is required.</span></span></span><br><span class="line">hz 10</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Normally it is useful to have an HZ value which is proportional to the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">number of clients connected. This is useful in order, for instance, to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">avoid too many clients are processed for each background task invocation</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">in order to avoid latency spikes.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Since the default HZ value by default is conservatively set to 10, Redis</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">offers, and enables by default, the ability to use an adaptive HZ value</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">which will temporary raise when there are many connected clients.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># When dynamic HZ is enabled, the actual configured HZ will be used as</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">as a baseline, but multiples of the configured HZ value will be actually</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">used as needed once more clients are connected. In this way an idle</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">instance will use very little CPU time while a busy instance will be</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">more responsive.</span></span></span><br><span class="line">dynamic-hz yes</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">When a child rewrites the AOF file, if the following option is enabled</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the file will be fsync-ed every 32 MB of data generated. This is useful</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">in order to commit the file to the disk more incrementally and avoid</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">big latency spikes.</span></span></span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">When redis saves RDB file, if the following option is enabled</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the file will be fsync-ed every 32 MB of data generated. This is useful</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">in order to commit the file to the disk more incrementally and avoid</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">big latency spikes.</span></span></span><br><span class="line">rdb-save-incremental-fsync yes</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Redis LFU eviction (see maxmemory setting) can be tuned. However it is a good</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">idea to start with the default settings and only change them after investigating</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">how to improve the performances and how the keys LFU change over time, which</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">is possible to inspect via the OBJECT FREQ command.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># There are two tunable parameters in the Redis LFU implementation: the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">counter logarithm factor and the counter decay time. It is important to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">understand what the two parameters mean before changing them.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The LFU counter is just 8 bits per key, it&#x27;s maximum value is 255, so Redis</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">uses a probabilistic increment with logarithmic behavior. Given the value</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">of the old counter, when a key is accessed, the counter is incremented in</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">this way:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># 1. A random number R between 0 and 1 is extracted.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">2. A probability P is calculated as 1/(old_value*lfu_log_factor+1).</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">3. The counter is incremented only if R &lt; P.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The default lfu-log-factor is 10. This is a table of how the frequency</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">counter changes with a different number of accesses with different</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">logarithmic factors:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># +--------+------------+------------+------------+------------+------------+</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">| factor | 100 hits   | 1000 hits  | 100K hits  | 1M hits    | 10M hits   |</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">+--------+------------+------------+------------+------------+------------+</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">| 0      | 104        | 255        | 255        | 255        | 255        |</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">+--------+------------+------------+------------+------------+------------+</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">| 1      | 18         | 49         | 255        | 255        | 255        |</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">+--------+------------+------------+------------+------------+------------+</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">| 10     | 10         | 18         | 142        | 255        | 255        |</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">+--------+------------+------------+------------+------------+------------+</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">| 100    | 8          | 11         | 49         | 143        | 255        |</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">+--------+------------+------------+------------+------------+------------+</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># NOTE: The above table was obtained by running the following commands:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#   redis-benchmark -n 1000000 incr foo</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">  redis-cli object freq foo</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># NOTE 2: The counter initial value is 5 in order to give new objects a chance</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">to accumulate hits.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The counter decay time is the time, in minutes, that must elapse in order</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">for the key counter to be divided by two (or decremented if it has a value</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">less &lt;= 10).</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The default value for the lfu-decay-time is 1. A Special value of 0 means to</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">decay the counter every time it happens to be scanned.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># lfu-log-factor 10</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">lfu-decay-time 1</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string">########################## ACTIVE DEFRAGMENTATION #######################</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># WARNING THIS FEATURE IS EXPERIMENTAL. However it was stress tested</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">even in production and manually tested by multiple engineers for some</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">time.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># What is active defragmentation?</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">-------------------------------</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Active (online) defragmentation allows a Redis server to compact the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">spaces left between small allocations and deallocations of data in memory,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">thus allowing to reclaim back memory.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Fragmentation is a natural process that happens with every allocator (but</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">less so with Jemalloc, fortunately) and certain workloads. Normally a server</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">restart is needed in order to lower the fragmentation, or at least to flush</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">away all the data and create it again. However thanks to this feature</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">implemented by Oran Agra for Redis 4.0 this process can happen at runtime</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">in an &quot;</span>hot<span class="string">&quot; way, while the server is running.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Basically when the fragmentation is over a certain level (see the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">configuration options below) Redis will start to create new copies of the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">values in contiguous memory regions by exploiting certain specific Jemalloc</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">features (in order to understand if an allocation is causing fragmentation</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">and to allocate it in a better place), and at the same time, will release the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">old copies of the data. This process, repeated incrementally for all the keys</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">will cause the fragmentation to drop back to normal values.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Important things to understand:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># 1. This feature is disabled by default, and only works if you compiled Redis</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   to use the copy of Jemalloc we ship with the source code of Redis.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   This is the default with Linux builds.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># 2. You never need to enable this feature if you don&#x27;t have fragmentation</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   issues.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># 3. Once you experience fragmentation, you can enable this feature when</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">   needed with the command &quot;</span>CONFIG SET activedefrag <span class="built_in">yes</span><span class="string">&quot;.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># The configuration parameters are able to fine tune the behavior of the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">defragmentation process. If you are not sure about what they mean it is</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">a good idea to leave the defaults untouched.</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Enabled active defragmentation</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">activedefrag yes</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Minimum amount of fragmentation waste to start active defrag</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">active-defrag-ignore-bytes 100mb</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Minimum percentage of fragmentation to start active defrag</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">active-defrag-threshold-lower 10</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Maximum percentage of fragmentation at which we use maximum effort</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">active-defrag-threshold-upper 100</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Minimal effort for defrag in CPU percentage</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">active-defrag-cycle-min 5</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Maximal effort for defrag in CPU percentage</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">active-defrag-cycle-max 75</span></span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Maximum number of set/hash/zset/list fields that will be processed from</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">the main dictionary scan</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">active-defrag-max-scan-fields 1000</span></span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="7">
<li><strong>使用redis6.0.8镜像创建容器(也叫运行镜像)</strong></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run  </span><br><span class="line">-p 6379:6379 </span><br><span class="line">--name myr3 </span><br><span class="line">--privileged=true </span><br><span class="line">-v /app/redis/redis.conf:/etc/redis/redis.conf </span><br><span class="line">-v /app/redis/data:/data </span><br><span class="line">-d redis:6.0.8 redis-server /etc/redis/redis.conf</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658386630490-14317133-6f0e-44b1-a15a-21966767b766.png#averageHue=%23fefafa&clientId=uc440a240-4b2c-4&from=paste&height=218&id=u6d7a0235&originHeight=218&originWidth=1352&originalType=binary&ratio=1&rotation=0&showTitle=false&size=47575&status=done&style=none&taskId=ud3d79329-7bcc-451e-b125-b2edbf44818&title=&width=1352" alt="image.png"></p>
<ol start="8">
<li><strong>测试redis-cli连接上来</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658386639463-b2b6c0a5-2dcb-49f8-9751-208fa735fd0f.png#averageHue=%23fefcfc&clientId=uc440a240-4b2c-4&from=paste&height=382&id=uec24ec8a&originHeight=382&originWidth=1355&originalType=binary&ratio=1&rotation=0&showTitle=false&size=68950&status=done&style=none&taskId=u042d713d-fb33-4948-890e-57e48d844ce&title=&width=1355" alt="image.png"><br><code>docker exec -it 运行着Rediis服务的容器ID redis-cli</code></p>
<ol start="9">
<li><strong>请证明docker启动使用了我们自己指定的配置文件</strong></li>
</ol>
<p>修改前<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658386662346-efff690c-15ef-4246-af15-3ceef75e82c1.png#averageHue=%23fefbfb&clientId=uc440a240-4b2c-4&from=paste&height=297&id=u9e861bfc&originHeight=297&originWidth=652&originalType=binary&ratio=1&rotation=0&showTitle=false&size=40601&status=done&style=none&taskId=ub5b34dd5-df04-43d7-b318-b346bae42cb&title=&width=652" alt="image.png"><br>我们用的配置文件，数据库默认是16个<br>修改后<br><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658386674971-89bd06ec-8496-40c8-835a-81019dbec40b.png#averageHue=%23faf7f4&clientId=uc440a240-4b2c-4&from=paste&height=402&id=u7aed5c97&originHeight=402&originWidth=937&originalType=binary&ratio=1&rotation=0&showTitle=false&size=75193&status=done&style=none&taskId=ua70db74a-9684-4dfb-9b80-d799a1fbc08&title=&width=937" alt="image.png"><br>宿主机的修改会同步给docker容器里面的配置。记得重启服务</p>
<ol start="10">
<li><strong>测试redis-cli连接上来第2次</strong></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/27791237/1658386695258-47156844-dae4-4919-9e77-fb9b215dff21.png#averageHue=%23fefcfc&clientId=uc440a240-4b2c-4&from=paste&height=410&id=ufe178d5c&originHeight=410&originWidth=1352&originalType=binary&ratio=1&rotation=0&showTitle=false&size=76878&status=done&style=none&taskId=u17c22d1f-2b91-47f9-be15-e60d6b8d211&title=&width=1352" alt="image.png"></p>
<h2 id="8-5-安装Nginx"><a href="#8-5-安装Nginx" class="headerlink" title="8.5 安装Nginx"></a>8.5 安装Nginx</h2><p>见高级篇Portainer</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://tuanliang.github.io">十一</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://tuanliang.github.io/2024/04/27/docker-2/">https://tuanliang.github.io/2024/04/27/docker-2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://tuanliang.github.io" target="_blank">十一的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Docker/">Docker</a></div><div class="post_share"><div class="social-share" data-image="/image/zhongguofeng.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/04/28/docker-3/" title="docker_3"><img class="cover" src="/image/spring.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">docker_3</div></div></a></div><div class="next-post pull-right"><a href="/2024/04/26/springboot/" title="springboot"><img class="cover" src="/image/yewan.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">springboot</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/04/28/docker-3/" title="docker_3"><img class="cover" src="/image/spring.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-28</div><div class="title">docker_3</div></div></a></div><div><a href="/2024/04/25/docker-1/" title="docker_1"><img class="cover" src="/image/yewanshu.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-25</div><div class="title">docker_1</div></div></a></div><div><a href="/2024/04/29/docker%E7%BD%91%E7%BB%9C-dockercompose/" title="docker网络_docker-compose"><img class="cover" src="/image/bike.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-29</div><div class="title">docker网络_docker-compose</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/image/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">十一</div><div class="author-info__description">归途也还可爱</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">52</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/tuanliang"><i class="fab fa-github"></i><span>关注我</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">个人简历在关于笔者一栏~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Docker%E9%95%9C%E5%83%8F"><span class="toc-number">1.</span> <span class="toc-text">4 Docker镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.0.1.</span> <span class="toc-text">4.1 是什么</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1-%E5%88%86%E5%B1%82%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">1.0.1.1.</span> <span class="toc-text">4.1.1 分层的镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-UnionFS%EF%BC%88%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%89"><span class="toc-number">1.0.1.2.</span> <span class="toc-text">4.1.2 UnionFS（联合文件系统）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-3-Docker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="toc-number">1.0.1.3.</span> <span class="toc-text">4.1.3 Docker镜像加载原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-4-%E4%B8%BA%E4%BB%80%E4%B9%88-Docker-%E9%95%9C%E5%83%8F%E8%A6%81%E9%87%87%E7%94%A8%E8%BF%99%E7%A7%8D%E5%88%86%E5%B1%82%E7%BB%93%E6%9E%84%E5%91%A2"><span class="toc-number">1.0.1.4.</span> <span class="toc-text">4.1.4 为什么 Docker 镜像要采用这种分层结构呢</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E9%87%8D%E7%82%B9%E7%90%86%E8%A7%A3"><span class="toc-number">1.0.2.</span> <span class="toc-text">4.2 重点理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-Docker%E9%95%9C%E5%83%8Fcommit%E6%93%8D%E4%BD%9C%E6%A1%88%E4%BE%8B"><span class="toc-number">1.0.3.</span> <span class="toc-text">4.3 Docker镜像commit操作案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1-%E6%A1%88%E4%BE%8B%E6%BC%94%E7%A4%BAubuntu%E5%AE%89%E8%A3%85vim"><span class="toc-number">1.0.3.1.</span> <span class="toc-text">4.3.1 案例演示ubuntu安装vim</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-2-%E5%B0%8F%E6%80%BB%E7%BB%93"><span class="toc-number">1.0.3.2.</span> <span class="toc-text">4.3.2 小总结</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91"><span class="toc-number">2.</span> <span class="toc-text">5 本地镜像发布到阿里云</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91%E6%B5%81%E7%A8%8B"><span class="toc-number">2.1.</span> <span class="toc-text">5.1 本地镜像发布到阿里云流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E9%95%9C%E5%83%8F%E7%9A%84%E7%94%9F%E6%88%90%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.</span> <span class="toc-text">5.2 镜像的生成方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E5%B0%86%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E6%8E%A8%E9%80%81%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91"><span class="toc-number">2.3.</span> <span class="toc-text">5.3 将本地镜像推送到阿里云</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-1-%E5%88%9B%E5%BB%BA%E4%BB%93%E5%BA%93%E9%95%9C%E5%83%8F"><span class="toc-number">2.3.1.</span> <span class="toc-text">5.3.1 创建仓库镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-2-%E5%B0%86%E9%95%9C%E5%83%8F%E6%8E%A8%E9%80%81%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91"><span class="toc-number">2.3.2.</span> <span class="toc-text">5.3.2 将镜像推送到阿里云</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E5%B0%86%E9%98%BF%E9%87%8C%E4%BA%91%E4%B8%8A%E7%9A%84%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD%E5%88%B0%E6%9C%AC%E5%9C%B0"><span class="toc-number">2.4.</span> <span class="toc-text">5.4 将阿里云上的镜像下载到本地</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0%E7%A7%81%E6%9C%89%E5%BA%93"><span class="toc-number">3.</span> <span class="toc-text">6 本地镜像发布到私有库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">3.1.</span> <span class="toc-text">6.1 是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E5%B0%86%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E6%8E%A8%E9%80%81%E5%88%B0%E7%A7%81%E6%9C%89%E5%BA%93"><span class="toc-number">3.2.</span> <span class="toc-text">6.2 将本地镜像推送到私有库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nexus%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93-%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4%E8%AF%B7%E7%9C%8Bxmind%E7%AC%94%E8%AE%B0"><span class="toc-number">3.3.</span> <span class="toc-text">Nexus私有仓库 详细步骤请看xmind笔记</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-Docker%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">4.</span> <span class="toc-text">7 Docker容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E5%9D%91%EF%BC%9A%E5%AE%B9%E5%99%A8%E5%8D%B7%E8%AE%B0%E5%BE%97%E5%8A%A0%E5%85%A5"><span class="toc-number">4.1.</span> <span class="toc-text">7.1 坑：容器卷记得加入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E5%9B%9E%E9%A1%BE%E4%B8%8B%E4%B8%8A%E4%B8%80%E8%AE%B2%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%8C%E5%8F%82%E6%95%B0V"><span class="toc-number">4.2.</span> <span class="toc-text">7.2 回顾下上一讲的知识点，参数V</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">4.3.</span> <span class="toc-text">7.3 是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-%E8%83%BD%E5%B9%B2%E5%98%9B"><span class="toc-number">4.4.</span> <span class="toc-text">7.4 能干嘛</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-%E6%95%B0%E6%8D%AE%E5%8D%B7%E6%A1%88%E4%BE%8B"><span class="toc-number">4.5.</span> <span class="toc-text">7.5 数据卷案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-1-%E5%AE%BF%E4%B8%BBvs%E5%AE%B9%E5%99%A8%E4%B9%8B%E9%97%B4%E6%98%A0%E5%B0%84%E6%B7%BB%E5%8A%A0%E5%AE%B9%E5%99%A8%E5%8D%B7"><span class="toc-number">4.5.1.</span> <span class="toc-text">7.5.1 宿主vs容器之间映射添加容器卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-2-%E8%AF%BB%E5%86%99%E8%A7%84%E5%88%99%E6%98%A0%E5%B0%84%E6%B7%BB%E5%8A%A0%E8%AF%B4%E6%98%8E"><span class="toc-number">4.5.2.</span> <span class="toc-text">7.5.2 读写规则映射添加说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-3-%E5%8D%B7%E7%9A%84%E7%BB%A7%E6%89%BF%E5%92%8C%E5%85%B1%E4%BA%AB"><span class="toc-number">4.5.3.</span> <span class="toc-text">7.5.3 卷的继承和共享</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-Docker%E5%B8%B8%E8%A7%84%E5%AE%89%E8%A3%85%E7%AE%80%E4%BB%8B"><span class="toc-number">5.</span> <span class="toc-text">8 Docker常规安装简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E6%80%BB%E4%BD%93%E6%AD%A5%E9%AA%A4"><span class="toc-number">5.1.</span> <span class="toc-text">8.1 总体步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E5%AE%89%E8%A3%85tomcat"><span class="toc-number">5.2.</span> <span class="toc-text">8.2 安装tomcat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E5%AE%89%E8%A3%85mysql"><span class="toc-number">5.3.</span> <span class="toc-text">8.3 安装mysql</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-1-docker-hub%E4%B8%8A%E9%9D%A2%E6%9F%A5%E6%89%BEmysql%E9%95%9C%E5%83%8F"><span class="toc-number">5.3.1.</span> <span class="toc-text">8.3.1 docker hub上面查找mysql镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-2-%E4%BB%8Edocker-hub%E4%B8%8A-%E9%98%BF%E9%87%8C%E4%BA%91%E5%8A%A0%E9%80%9F%E5%99%A8-%E6%8B%89%E5%8F%96mysql%E9%95%9C%E5%83%8F%E5%88%B0%E6%9C%AC%E5%9C%B0%E6%A0%87%E7%AD%BE%E4%B8%BA5-7"><span class="toc-number">5.3.2.</span> <span class="toc-text">8.3.2 从docker hub上(阿里云加速器)拉取mysql镜像到本地标签为5.7</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-3-%E4%BD%BF%E7%94%A8mysql5-7%E9%95%9C%E5%83%8F%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8-%E4%B9%9F%E5%8F%AB%E8%BF%90%E8%A1%8C%E9%95%9C%E5%83%8F"><span class="toc-number">5.3.3.</span> <span class="toc-text">8.3.3 使用mysql5.7镜像创建容器(也叫运行镜像)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-3-1-%E5%91%BD%E4%BB%A4%E5%87%BA%E5%A4%84%EF%BC%8C%E5%93%AA%E9%87%8C%E6%9D%A5%E7%9A%84%EF%BC%9F"><span class="toc-number">5.3.3.1.</span> <span class="toc-text">8.3.3.1 命令出处，哪里来的？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-3-2-%E7%AE%80%E5%8D%95%E7%89%88"><span class="toc-number">5.3.3.2.</span> <span class="toc-text">8.3.3.2 简单版</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-3-3-%E5%AE%9E%E6%88%98%E7%89%88"><span class="toc-number">5.3.3.3.</span> <span class="toc-text">8.3.3.3 实战版</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-%E5%AE%89%E8%A3%85redis"><span class="toc-number">5.4.</span> <span class="toc-text">8.4 安装redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-5-%E5%AE%89%E8%A3%85Nginx"><span class="toc-number">5.5.</span> <span class="toc-text">8.5 安装Nginx</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/09/16/JS%E9%AB%98%E7%BA%A7-%E9%98%B2%E6%8A%96-%E8%8A%82%E6%B5%81-%E6%B7%B1%E6%8B%B7%E8%B4%9D-%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF/" title="JS高级-防抖_节流_深拷贝_事件总线"><img src="/image/yewan.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JS高级-防抖_节流_深拷贝_事件总线"/></a><div class="content"><a class="title" href="/2024/09/16/JS%E9%AB%98%E7%BA%A7-%E9%98%B2%E6%8A%96-%E8%8A%82%E6%B5%81-%E6%B7%B1%E6%8B%B7%E8%B4%9D-%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF/" title="JS高级-防抖_节流_深拷贝_事件总线">JS高级-防抖_节流_深拷贝_事件总线</a><time datetime="2024-09-16T07:03:31.000Z" title="发表于 2024-09-16 15:03:31">2024-09-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/16/JS%E9%AB%98%E7%BA%A7-%E5%BC%82%E5%B8%B8-Storage-%E6%AD%A3%E5%88%99/" title="JS高级-异常_Storage_正则"><img src="/image/walk.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JS高级-异常_Storage_正则"/></a><div class="content"><a class="title" href="/2024/09/16/JS%E9%AB%98%E7%BA%A7-%E5%BC%82%E5%B8%B8-Storage-%E6%AD%A3%E5%88%99/" title="JS高级-异常_Storage_正则">JS高级-异常_Storage_正则</a><time datetime="2024-09-16T07:02:13.000Z" title="发表于 2024-09-16 15:02:13">2024-09-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/15/JS%E9%AB%98%E7%BA%A7-await_async_%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/" title="JS高级-await"><img src="/image/walk.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JS高级-await"/></a><div class="content"><a class="title" href="/2024/09/15/JS%E9%AB%98%E7%BA%A7-await_async_%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/" title="JS高级-await">JS高级-await</a><time datetime="2024-09-15T07:03:40.000Z" title="发表于 2024-09-15 15:03:40">2024-09-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/15/JS%E9%AB%98%E7%BA%A7-Iterator-Generator%E8%AF%A6%E8%A7%A3/" title="JS高级-Iterator_Generator详解"><img src="/image/tianyuan.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JS高级-Iterator_Generator详解"/></a><div class="content"><a class="title" href="/2024/09/15/JS%E9%AB%98%E7%BA%A7-Iterator-Generator%E8%AF%A6%E8%A7%A3/" title="JS高级-Iterator_Generator详解">JS高级-Iterator_Generator详解</a><time datetime="2024-09-15T07:02:36.000Z" title="发表于 2024-09-15 15:02:36">2024-09-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/15/JS%E9%AB%98%E7%BA%A7-Promise%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/" title="JS高级-Promise使用详解"><img src="/image/spring.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JS高级-Promise使用详解"/></a><div class="content"><a class="title" href="/2024/09/15/JS%E9%AB%98%E7%BA%A7-Promise%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/" title="JS高级-Promise使用详解">JS高级-Promise使用详解</a><time datetime="2024-09-15T07:01:15.000Z" title="发表于 2024-09-15 15:01:15">2024-09-15</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/image/zhongguofeng.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024  <i id="heartbeat" class="fa fas fa-heartbeat"></i> 十一</div><div class="footer_custom_text">十一的博客</div></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'ws2gX4Ds7Q3br3Z7ORXNr3NI-gzGzoHsz',
      appKey: 'NLF6z82Nd60EfdSBbPEPM0J3',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, {"placeholder":"评论一下"}))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.jsdelivr.net/npm/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !true) {
    if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script src="/style/js/custom.js"></script><script async src="/style/js/categoryBar.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'a4a0a2a7266d411881101f0fce4b32ec';
  var gaud_map_key = '3dd03960aa863fc05ac90b405bf769b1';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '112.982279,28.19409';
  var clock_default_rectangle_enable = 'false';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/04/22/spring-aop、事务/" alt=""><img width="48" height="48" src="/image/walk.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-04-22</span><a class="blog-slider__title" href="2024/04/22/spring-aop、事务/" alt="">spring_aop、事务</a><div class="blog-slider__text">这是显示在首页的概述，正文内容均会被隐藏。</div><a class="blog-slider__button" href="2024/04/22/spring-aop、事务/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/04/29/docker网络-dockercompose/" alt=""><img width="48" height="48" src="/image/bike.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-04-29</span><a class="blog-slider__title" href="2024/04/29/docker网络-dockercompose/" alt="">docker网络_docker-compose</a><div class="blog-slider__text">这是显示在首页的概述，正文内容均会被隐藏。</div><a class="blog-slider__button" href="2024/04/29/docker网络-dockercompose/" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="2024/06/25/软考高级系统架构师通过/" alt=""><img width="48" height="48" src="/image/spring.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-06-25</span><a class="blog-slider__title" href="2024/06/25/软考高级系统架构师通过/" alt="">软考高级系统架构师通过</a><div class="blog-slider__text">生活随笔</div><a class="blog-slider__button" href="2024/06/25/软考高级系统架构师通过/" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><!-- hexo injector body_end end --></body></html>